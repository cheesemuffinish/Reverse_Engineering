/* =============================================================
 * Copyright (c) 2014 TP-LINK Technologies Co., Ltd.
 *
 * @version: 0.0.1
 * @author: TP-Mobile Web Team
 * =============================================================*/

function doLogout(){AuthModel.logout(function(){window.location.href="/"})}function langSwitch(){callJSON(WEB_MODULE,ACTION.SET_LANGUAGE,{language:$("#langSel").val()},function(a){0===a.result&&window.location.reload()})}function bindHelpEvent(){$("#helpBtn").click(function(){return $("#helpPopup").is(":visible")?$("#helpPopup").slideUp():$("#helpPopup").slideDown(),$(document).on("click.helpPopup",function(a){0===$(a.target).closest(".help-popup").length&&($("#helpPopup").hide(),$(document).off(".helpPopup"))}),!1})}function getElectricityCls(a){var b,c=a.battery.charging,d=a.battery.voltage;if(a.battery.connected===!1)return elecIconCls="icon-top-electricity-0";if(c){if(100===d)return elecIconCls="icon-top-electricity-100";b="icon-top-charging-"}else b="icon-top-electricity-";return elecIconCls=d>95?b+100:d>=90?b+90:d>=80?b+80:d>=70?b+70:d>=60?b+60:d>=50?b+50:d>=40?b+40:d>=30?b+30:d>=20?b+20:d>10?b+10:d>=0?b+0:b+0}function addPopupDialog(a,b){Settings.$cover&&(Settings.$cover.remove(),Settings.$cover=null),Settings.$popupDialog&&Settings.$popupDialog.remove(),Settings.$popupDialog=$('<div class="popup-toast hide"><i class="'+a+'"></i><span class="text">'+b+"</span></div>"),$(".panel-sections").append(Settings.$popupDialog)}function removeSettingDialog(){Settings.$cover&&(Settings.$cover.remove(),Settings.$cover=null),Settings.$popupDialog&&(Settings.$popupDialog.stop().remove(),Settings.$popupDialog=null)}!function(a){function b(){a.i18n.elementLocalization("#adv_panel-wrapper",["span","button","label"]),a.i18n.switchFont()}function c(b){a("#macAddrHeaderRow").nextAll().remove(),l&&0!==l.length?(a("#resumeItem").removeClass("disable"),a("#resumeItem").unbind("click").click(function(){a("#macAddrHeaderRow").nextAll().find("input:checked").length>0?a("#deletePopup").popup("show"):a("#deleteEmptyPopup").popup("show")})):(a("#resumeItem").addClass("disable"),a("#resumeItem").unbind("click"));var c="",d=0,e=0,g={};for(d=0;m>d&&(e=m*(b-1)+d,!(e>=l.length));d++)g=l[e],c+='<tr><td><label class="checkbox child"><input type="checkbox" id="index'+e+'"><span class="icon-unchecked"></span></label></td><td class="name-content" id="ID'+(e+1)+'">'+(e+1+"")+"</td><td>"+g.description+"</td><td>"+g.mac+"</td></tr>";var h=a(c);a("#macAddrHeaderRow").after(h),h.find(".checkbox").checkbox(),h.find(".checkbox").click(function(){var c,d,e=0;h.find(".checkbox input").each(function(){a(this).prop("checked")&&e++,c=f(),d=b>=c?l.length-m*(b-1):m,e===d?a("#selectAll").checkbox("setChecked",!0):a("#selectAll").checkbox("setChecked",!1)})}),a("#selectAll").checkbox("setChecked",!1)}function d(b){k=b,l=b.denyList,l||(l=[]),a("#pagination").pagination({totalPage:f(),onChanged:c}),a(".blackListSection").show()}function e(b){callJSON(n,1,b,function(b){0===b.result?Settings.showSavedDialog(a.i18n.prop("successfullTip")):Settings.showFailedDialog(a.i18n.prop("resumeFailedTip"))})}function f(){return Math.ceil(l.length/m)}function g(){var a={};a.mode=1,a.enable=!0,a.denyList=l,e(a)}function h(){getConfigJSON(n,d)}function i(){var b=[];if(a("#macAddrHeaderRow").nextAll().find("input:checked").each(function(){a(this).prop("checked")&&b.push(parseInt(a(this).attr("id").substring(5),10))}),b.length===l.length&&(a("#resumeItem").addClass("disable"),a("#resumeItem").unbind("click")),0!==b.length){for(var c=b.length-1;c>=0;c--)l.splice(b[c],1);g()}a("#pagination").pagination("pageCount",f()),a("#pagination").pagination("refresh"),a("#selectAll").checkbox("setChecked",!1)}function j(){a("#deletePopup").popup({$closeButtons:a("#deleteCancel")}),a("#btnYes").click(function(){a("#deletePopup").popup("hide"),i()}),a("#deleteEmptyPopup").popup({$closeButtons:a("#deleteEmptyOK")}),a("#refreshBlackList").click(function(){a("#tableMacAddrList td").empty(),h()})}var k=null,l=null,m=8,n="macFilters";a.blackList={onLoad:function(){b(),a("#selectAll").checkbox(".child"),j(),h()},onLeave:function(){l=null}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#adv_panel-wrapper",["label","span","button"]),a.i18n.switchFont()}function c(){return Math.ceil(m.length/t)}function d(b){a("#clientListHeaderRow").nextAll().remove(),m&&0!==m.length?(a("#blockItem").removeClass("disable"),a("#blockItem").unbind("click").click(function(){a("#clientListHeaderRow").nextAll().find("input:checked").length>0?a("#blockPopup").popup("show"):a("#blockEmptyPopup").popup("show")})):(a("#blockItem").addClass("disable"),a("#blockItem").unbind("click"));var d="",e=0,f={};for(i=0;t>i&&(e=t*(b-1)+i,!(e>=m.length));i++)f=m[e],d+=s!==f.mac?'<tr><td><label class="checkbox child"><input type="checkbox" id="index'+e+'"><span class="icon-unchecked"></span></label></td><td class="name-content" id="name'+(e+1)+'"></td><td>'+f.mac+"</td><td>"+f.ip+"</td></tr>":'<tr><td><label><span class="icon-dischecked"></span></label></td><td class="name-content" id="name'+(e+1)+'"></td><td>'+f.mac+"</td><td>"+f.ip+"</td></tr>";for(p=a(d),a("#clientListHeaderRow").after(p),i=0;t>i&&(e=t*(b-1)+i,!(e>=m.length));i++)f=m[e],a("#name"+(e+1)).text("string"==typeof f.name?f.name:"");p.find(".checkbox").checkbox(),p.find(".checkbox").click(function(){var d,e,f=0;p.find(".checkbox input").each(function(){a(this).prop("checked")&&f++,d=c(),e=b>=d&&1!=d?m.length-t*(b-1):1==d?m.length-t*(b-1)-o:1==b&&1!=d?t-o:t,f===e?a("#selectAll").checkbox("setChecked",!0):a("#selectAll").checkbox("setChecked",!1)})}),a("#selectAll").checkbox("setChecked",!1)}function e(){getConfigJSON(r,g)}function f(b){var e,f={};for(oldData=b,m=oldData.STAs.list,m||(m=[]),e=0;e<m.length;e++)f=m[e],s===f.mac&&(m.splice(e,1),m.unshift(f));a("#pagination").pagination({totalPage:c(),onChanged:d}),a(".clientListSection").show()}function g(a){n=a.denyList,s=a.clientMac,o=null==s||""==s?0:1,n||(n=[]),getConfigJSON(q,f)}function h(b){callJSON(r,1,b,function(b){0===b.result?Settings.showSavedDialog(a.i18n.prop("successfullTip")):Settings.showFailedDialog(a.i18n.prop("blockFailedTip"))})}function j(){var a={};a.mode=1,a.enable=!0,a.denyList=n,h(a)}function k(){var b,d=[],e={},f={};if(a("#clientListHeaderRow").nextAll().find("input:checked").each(function(){a(this).prop("checked")&&d.push(parseInt(a(this).attr("id").substring(5),10))}),d.length===m.length&&(a("#blockItem").addClass("disable"),a("#blockItem").unbind("click")),b=d.length+n.length,0!==d.length&&10>=b){for(var g=d.length-1;g>=0;g--)e=m[d[g]],e.mac!==s&&(f={},f.mac=e.mac.replace(/:/g,"-"),f.description=e.name,n.push(f));j();for(var g=d.length-1;g>=0;g--)e=m[d[g]],e.mac!==s&&m.splice(d[g],1)}else 0!==d.length&&b>10&&a("#blockOverPopup").popup("show");a("#pagination").pagination("pageCount",c()),a("#pagination").pagination("refresh"),a("#selectAll").checkbox("setChecked",!1)}function l(){a("#blockPopup").popup({$closeButtons:a("#deleteCancel")}),a("#blockEmptyPopup").popup({$closeButtons:a("#deleteEmptyOK")}),a("#blockOverPopup").popup({$closeButtons:a("#btnOK")}),a("#btnYes").click(function(){a("#blockPopup").popup("hide"),k()}),a("#refreshClientList").click(function(){a("#tableClientList td").empty(),e()})}var m,n,o,p,q="connectedDevices",r="macFilters",s="",t=8;a.clientList={onLoad:function(){b(),a("#selectAll").checkbox(".child"),l(),e()}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#adv_panel-wrapper",["label","span","button","option"]),a.i18n.switchFont()}function c(){a("#dataCorrectUnitSelect").dropdown({width:"85px"}),a("#monthQuotaUnitSelect").dropdown({width:"85px"}),a("#paymentDateSwitch").switchButton({onChanged:function(b){b?(a("#paymentDateInput").parent().slideDown("fast"),a("#dataCorrectionLbl").text(a.i18n.prop("dataCorrectionLbl")),a("#monthQuotaLbl").text(a.i18n.prop("monthQuotaLbl"))):(a("#paymentDateInput").parent().slideUp("fast"),a("#dataCorrectionLbl").text(a.i18n.prop("totalUsedLbl")),a("#monthQuotaLbl").text(a.i18n.prop("totalQuotaLbl")))}}),a("#dataLimitSwitch").switchButton({onChanged:function(b){b?(a(".dataLimit").slideDown("fast"),a("#monthQuotaInput").val()||a("#monthQuotaInput").focus()):a(".dataLimit").slideUp("fast"),a(".dataSettingSection").validate("resetForm",paymentDateInput,!1)}}),a("#dataCorrectBtn").click(function(){a("#dataCorrectBtn").text()===a.i18n.prop("dataCorrectBtn")?(a("#usedDataSpan").hide(),a("#dataCorrectInput").show(),a("#dataCorrectUnitSelect").parent().show(),a("#dataCorrectInput").focus(),a("#dataCorrectBtn").text(a.i18n.prop("dataCancelBtn"))):(a("#dataCorrectInput").val(f),a("#dataCorrectUnitSelect").dropdown("select",g),a("#dataCorrectInput").hide(),a("#dataCorrectUnitSelect").parent().hide(),a("#usedDataSpan").show(),a("#dataCorrectBtn").text(a.i18n.prop("dataCorrectBtn")))}),a("#dataUsageSave").click(function(){var b={},c={},d=1;a(".dataSettingSection").valid()&&(c.enableDataLimit=a("#dataLimitSwitch").switchButton("checked"),c.enablePaymentDay=a("#paymentDateSwitch").switchButton("checked"),c.warningPercent=h,c.paymentDay=Number(a("#paymentDateInput").val()),c.limitation=a("#monthQuotaUnitSelect").dropdown("select")===j.MB?""+Number(1024*a("#monthQuotaInput").val()*1024):""+Number(1024*a("#monthQuotaInput").val()*1024*1024),a("#dataCorrectInput").is(":visible")&&(c.adjustStatistics=a("#dataCorrectUnitSelect").dropdown("select")===j.MB?""+Number(1024*a("#dataCorrectInput").val()*1024):""+Number(1024*a("#dataCorrectInput").val()*1024*1024)),b.settings=c,callJSON(i,d,b,function(b){0===b.result?(getConfigJSON(i,e),Settings.showSavedDialog()):1===b.result&&Settings.showToast("icon-save-failed",a.i18n.prop("failedText"))}))}),a.Validator.addRule("dataUsedInputRequired",function(b){return""===b?(a("#dataCorrectUnitSelect").parent().hide(),a("#dataCorrectBtn").hide(),!1):(a("#dataCorrectUnitSelect").parent().show(),a("#dataCorrectBtn").show(),!0)},a.i18n.prop("required")),a.Validator.addRule("validDataUsedInput",function(b){return is_number(b,0,999999)?(a("#dataCorrectUnitSelect").parent().show(),a("#dataCorrectBtn").show(),!0):(a("#dataCorrectUnitSelect").parent().hide(),a("#dataCorrectBtn").hide(),!1)},a.i18n.prop("badCorrectDataErr")),a.Validator.addRule("validDecimalsInput",function(b,c){return 5===b.length&&b.indexOf(".")>0&&b.indexOf(".")<2||6===b.length&&b.indexOf(".")>0&&b.indexOf(".")<3?("dataCorrectInput"===c.id?(a("#dataCorrectUnitSelect").parent().hide(),a("#dataCorrectBtn").hide()):"monthQuotaInput"===c.id&&a("#monthQuotaUnitSelect").parent().hide(),!1):!0},a.i18n.prop("badDecimalsErr")),a.Validator.addRule("validPaymentDateInput",function(a){return is_number(a,1,31)},a.i18n.prop("badPaymentDateErr")),a.Validator.addRule("validDataAllowance",function(b){return is_number(b,1,999999)?(a("#monthQuotaUnitSelect").parent().show(),!0):(a("#monthQuotaUnitSelect").parent().hide(),!1)},a.i18n.prop("badmonthQuotaErr")),a.Validator.addRule("validUsageAlert",function(a){return is_number(a,0,100)&&-1===a.indexOf(".")},a.i18n.prop("badRemindErr")),a(".dataSettingSection").validate({rules:{dataCorrectInput:{dataUsedInputRequired:!0,validDataUsedInput:!0,validDecimalsInput:{id:"dataCorrectInput"}},paymentDateInput:{required:!0,validPaymentDateInput:!0},monthQuotaInput:{required:!0,validDataAllowance:!0,validDecimalsInput:{id:"monthQuotaInput"}}}})}function d(){getConfigJSON(i,e)}function e(b){var c=Number(b.settings.adjustStatistics),d=Number(b.settings.limitation);c>=1073741824?(f=byte2GB(c),a("#dataCorrectUnitSelect").dropdown("select",1),a("#usedDataSpan").text(f+" GB"),g=1):(f=byte2MB(c),a("#dataCorrectUnitSelect").dropdown("select",0),f?a("#usedDataSpan").text(f+" MB"):a("#usedDataSpan").text("0 MB"),g=0),a("#dataCorrectInput").val(f).hide(),a("#dataCorrectUnitSelect").parent().hide(),a("#usedDataSpan").show(),a("#dataCorrectBtn").text(a.i18n.prop("dataCorrectBtn")),a("#paymentDateInput").val(b.settings.paymentDay),d>=1073741824?(d=byte2GB(d),a("#monthQuotaUnitSelect").dropdown("select",1)):(d=byte2MB(d),a("#monthQuotaUnitSelect").dropdown("select",0)),d&&a("#monthQuotaInput").val(d),h=b.settings.warningPercent,a("#paymentDateSwitch").switchButton("changeState",b.settings.enablePaymentDay,!0),a("#paymentDateSwitch").switchButton("change"),a("#dataLimitSwitch").switchButton("changeState",b.settings.enableDataLimit,!0),a("#dataLimitSwitch").switchButton("change"),a(".dataSettingSection").show()}var f,g,h,i="flowstat",j={MB:0,GB:1};a.dataSettings={onLoad:function(){b(),c(),d()}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#adv_panel-wrapper",["label","span","button","option"]),a.i18n.switchFont()}function c(){getConfigJSON(f,d)}function d(b){a("#accessModeSelect").dropdown("select",b.mode),b.mode===Number(g.byWifi)&&(a("#loginPermissionSelect").dropdown("select",b.login),a("#accessModeSelect").dropdown("select",b.mode)),a(".dataSharingSection").show()}function e(){a("#accessModeSelect").dropdown({onChanged:function(){a("#accessModeSelect").val()===g.byWifi?a("#loginPermissionSelect").parent().parent().slideDown("fast"):a("#loginPermissionSelect").parent().parent().slideUp("fast")}}),a("#loginPermissionSelect").dropdown(),a("#dataSharingSave").click(function(){var b={},c=1;b.mode=a("#accessModeSelect").dropdown("pos"),b.login=0,b.rwPermission=1,a("#accessModeSelect").val()===g.byWifi&&(b.login=a("#loginPermissionSelect").dropdown("pos")),callJSON(f,c,b,function(b){0===b.result?(a("#storage_err_message").text(""),Settings.showSavedDialog()):1===b.result&&Settings.showToast("icon-save-failed",a.i18n.prop("failedText"))})})}var f="storageShare",g={byUsb:"0",byWifi:"1"};a.dataSharing={onLoad:function(){b(),e(),c()}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#adv_panel-wrapper",["label","span"]),a.i18n.switchFont()}function c(b){a("#deviceName").text(b.deviceInfo.model),a("#swVersion").text(b.deviceInfo.firmwareVer),a("#hwVersion").text(b.deviceInfo.hardwareVer),a("#IMEI").text(b.deviceInfo.imei),a("#MACAddress").text(b.deviceInfo.mac),a("#imsi").text(b.deviceInfo.imsi),a("#simNumber").text(b.deviceInfo.simNumber),b.deviceInfo.imsi?a("#imsi").parent().show():a("#imsi").parent().hide(),b.deviceInfo.simNumber?a("#simNumber").parent().show():a("#simNumber").parent().hide()}function d(){getConfigJSON(e,c)}var e="status";a.deviceInfo={onLoad:function(){b(),d()}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#adv_panel-wrapper",["label","span","button"]),a.i18n.switchFont()}function c(){a("#dhcpServerSwitch").switchButton(),a("#wifiRebootPopup").popup({$closeButtons:a("#wifiRebootCancel")}),a("#dhcpSaveBtn").click(function(){var b={};return a("#addrLeaseTimeInput").keyup(),a(".dhcpSection").valid()?(k.ip=a("#ipAddressInput").val(),k.mask=a("#subnetMaskInput").val(),b.enable=a("#dhcpServerSwitch").switchButton("checked"),b.start=a("#dhcpStartAddrInput").val(),b.end=a("#dhcpEndAddrInput").val(),b.leaseTime=60*a("#addrLeaseTimeInput").val(),b.dns1=a("#primaryDNSInput").val(),b.dns2=a("#secondaryDNSInput").val(),""===b.dns2&&(b.dns2="0.0.0.0"),k.dhcp=b,isEqual(k.dhcp,h.dhcp)&&isEqual(k.ip,h.ip)&&isEqual(k.mask,h.mask)?(Settings.showToast("icon-save-failed",a.i18n.prop("noChangeText")),void 0):(a("#dhcpServerSwitch").switchButton("checked")?a("#dhcpRebootConfirmText").text(a.i18n.prop("dhcpRebootConfirmText")):a("#dhcpRebootConfirmText").text(a.i18n.prop("dhcpServerOffRebootText")+" "+a.i18n.prop("dhcpRebootConfirmText")),a("#wifiRebootPopup").popup("show"),void 0)):void 0}),a("#wifiRebootOK").click(function(){var b=1;a("#wifiRebootPopup").popup("hide"),callJSON(i,b,k,function(b){switch(b.result){case l.RESULT_OK:j=0,a("#rebootProgressPopup").popup("show"),g();break;case l.RESULT_FAIL:Settings.showToast("icon-save-failed",a.i18n.prop("failedText"));break;case l.RESULT_LAN_IP_ERROR:a("#errMessage").text(a.i18n.prop("badIPAddressErr")),a("#errMessagePopup").popup("show"),a("#ipAddressInput").focus();break;case l.RESULT_LAN_MASK_ERROR:a("#errMessage").text(a.i18n.prop("badMaskErr")),a("#errMessagePopup").popup("show"),a("#subnetMaskInput").focus();break;case l.RESULT_DHCP_SERVER_START_IP_ERROR:a("#errMessage").text(a.i18n.prop("badStartIPErr1")),a("#errMessagePopup").popup("show"),a("#dhcpStartAddrInput").focus();break;case l.RESULT_DHCP_SERVER_END_IP_ERROR:a("#errMessage").text(a.i18n.prop("badEndIPErr1")),a("#errMessagePopup").popup("show"),a("#dhcpEndAddrInput").focus();break;case l.RESULT_DHCP_SERVER_DNS_ERROR:a("#errMessage").text(a.i18n.prop("badDNSErr")),a("#errMessagePopup").popup("show"),a("#primaryDNSInput").focus();break;case l.RESULT_DHCP_SERVER_DNS_BAK_ERROR:a("#errMessage").text(a.i18n.prop("badDNSErr")),a("#errMessagePopup").popup("show"),a("#secondaryDNSInput").focus()}b.result>0&&(window.clearTimeout(m),a("#rebootProgressPopup").popup("hide"),Settings.showToast("icon-save-failed",a.i18n.prop("failedText")))})}),a("#rebootProgressPopup").popup({noXButton:!0}),a("#errMessagePopup").popup({$closeButtons:a("#errOK")}),a.Validator.addRule("validIPAddress",function(a){return is_ipaddr(a)},a.i18n.prop("badIPAddressErr")),a.Validator.addRule("validPrivateAddress",function(a){return is_privateIPaddr(a)},a.i18n.prop("badPrivateIPErr")),a.Validator.addRule("validDNSAddress",function(a){return is_ipaddr(a)},a.i18n.prop("badDNSErr")),a.Validator.addRule("validSecondaryDNSAddress",function(a){return""!==a?is_ipaddr(a):!0},a.i18n.prop("badDNSErr")),a.Validator.addRule("validSubnetMask",function(a){return chkNetworkMask(a)},a.i18n.prop("badMaskErr")),a.Validator.addRule("validIPMask",function(b){return chkIpMask(a("#ipAddressInput").val(),b)},a.i18n.prop("badMaskErr")),a.Validator.addRule("validLeaseTime",function(a){return is_integer(a,2,2880)},a.i18n.prop("badLeaseErr")),a.Validator.addRule("dhcpRangeInvalid",function(b,c){var d=a("#"+c.gatewayId).val(),e=a("#"+c.maskId).val();if(!is_ipaddr(b))return a.Validator.setErrorMessage("dhcpRangeInvalid",a.i18n.prop("badIPAddressErr")),!1;var f=chkIpInNetwork(b,d,e);return 2===f?(a.Validator.setErrorMessage("dhcpRangeInvalid",a.i18n.prop("badPoolErr")),!1):!0},a.i18n.prop("badIPAddressErr")),a.Validator.addRule("rangeSmaller",function(b,c){return dotIpToInt(b)<=dotIpToInt(a("#"+c).val())},a.i18n.prop("rangeSmallerInvalid")),a.Validator.addRule("rangeBigger",function(b,c){return dotIpToInt(b)>=dotIpToInt(a("#"+c).val())},a.i18n.prop("rangeBiggerInvalid")),a(".dhcpSection").validate({rules:{dhcpStartAddrInput:{required:!0,dhcpRangeInvalid:{msgType:"start",gatewayId:"ipAddressInput",maskId:"subnetMaskInput"},rangeSmaller:"dhcpEndAddrInput",trigger:["dhcpEndAddrInput"]},dhcpEndAddrInput:{required:!0,dhcpRangeInvalid:{msgType:"end",gatewayId:"ipAddressInput",maskId:"subnetMaskInput"},rangeBigger:"dhcpStartAddrInput",trigger:["dhcpStartAddrInput"]},addrLeaseTimeInput:{required:!0,validLeaseTime:!0},ipAddressInput:{required:!0,validIPAddress:!0,validPrivateAddress:!0,trigger:["subnetMaskInput"]},subnetMaskInput:{required:!0,validIPAddress:!0,validSubnetMask:!0,validIPMask:!0},primaryDNSInput:{required:!0,validDNSAddress:!0},secondaryDNSInput:{validSecondaryDNSAddress:!0}}}),a("#addrLeaseTimeInput").keyup(function(){is_integer(a("#addrLeaseTimeInput").val(),2,2880)===!0?a("#leaseTimeTips").show():a("#leaseTimeTips").hide()})}function d(){getConfigJSON(i,e)}function e(b){h=b,a("#ipAddressInput").val(b.ip),a("#subnetMaskInput").val(b.mask),a("#dhcpServerSwitch").switchButton("changeState",b.dhcp.enable,!0),a("#dhcpStartAddrInput").val(b.dhcp.start),a("#dhcpEndAddrInput").val(b.dhcp.end),a("#addrLeaseTimeInput").val(parseInt(b.dhcp.leaseTime/60)),a("#primaryDNSInput").val(b.dhcp.dns1),a("#secondaryDNSInput").val(b.dhcp.dns2),a(".dhcpSection").show()}function f(){j&&(a("#progressBar").css("width",String(j/10)+"%"),a("#progressBar").text(parseInt(j/10)+"%"))}function g(){return j>1e3?(location.href="http://tplinkmifi.net/",void 0):(1e3>=j&&(m=window.setTimeout(g,20),f(),j++),void 0)}var h,i="lan",j=0,k={},l={RESULT_OK:0,RESULT_FAIL:1,RESULT_LAN_IP_ERROR:2,RESULT_LAN_MASK_ERROR:3,RESULT_DHCP_SERVER_START_IP_ERROR:4,RESULT_DHCP_SERVER_END_IP_ERROR:5,RESULT_DHCP_SERVER_DNS_ERROR:6,RESULT_DHCP_SERVER_DNS_BAK_ERROR:7},m=0;a.dhcpServerConfig={onLoad:function(){b(),c(),d()}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#adv_panel-wrapper",["label","span","button","option"]),a.i18n.switchFont()}function c(){dualIPVersionSupport&&(a("#pdpTypeSelect").dropdown("addItem",a.i18n.prop("ipv4Andipv6PdpOpt"),"2",2),a("#crePdpTypeSelect").dropdown("addItem",a.i18n.prop("ipv4Andipv6PdpOpt"),"2",2)),getConfigJSON(o,d)}function d(b){for(n=b.dataSwitchStatus,l=b.profileSettings,m=b.roamingEnabled,a("#mobileDataSwitch").switchButton("changeState",b.dataSwitchStatus,!0),b.dataSwitchStatus?b.connectStatus===Number(q.disconnected)?g():b.connectStatus===Number(q.disconnecting)?window.setTimeout(g,2e3):a("#disconnectedReason").text(""):a("#disconnectedReason").text(""),a("#roamSwitch").switchButton("changeState",b.roamingEnabled,!0),c=a("#proListSelect").find("option").length;c>=0;c--)a("#proListSelect").dropdown("removeItem",c);for(var c=0;c<b.profileSettings.list.length;c++)a("#proListSelect").dropdown("addItem",b.profileSettings.list[c].profileName,c,c),c===b.profileSettings.activeProfile&&a("#proListSelect").dropdown("select",c),c>=b.profileSettings.defaultProfile&&a("#proListSelect").dropdown("setRemovable",c);a(".dialUpSection").show()}function e(){a("#proListSelect").dropdown(),a("#mobileDataSwitch").switchButton(),a("#roamSwitch").switchButton(),a(".pdpTypeSelect").dropdown(),a(".authTypeSelect").dropdown(),a("#dialUpTypeSelect").dropdown({onChanged:function(){a("#dialUpTypeSelect").val()===p.manual?(a("#connectBtn").show(),a("#maxIdleTimeInput").parent().hide()):a("#dialUpTypeSelect").val()===p.demand?(a("#connectBtn").hide(),a("#maxIdleTimeInput").parent().show()):(a("#connectBtn").hide(),a("#maxIdleTimeInput").parent().hide())}}),a("#proListSelect").dropdown({onChanged:function(){var b=a("#proListSelect").val();a("#save_err_message").text(""),a("#proNameInput").val(l.list[b].profileName),a("#pdpTypeSelect").dropdown("select",l.list[b].pdpType),l.list[b].pdpType===Number(r.ipv4)||l.list[b].pdpType===Number(r.ipv4_ipv6)?(a("#apnTypeSelect").dropdown("select",l.list[b].ipv4ApnType),a("#apnTypeSelect").val()===s.dynamic?(a("#apnInput").parent().hide(),a("#apnInput").val("")):(a("#apnInput").parent().show(),a("#apnInput").val(l.list[b].ipv4Apn)),a("#userNameInput").val(l.list[b].ipv4Username),a("#passwordInput").val(l.list[b].ipv4Password),a("#authTypeSelect").dropdown("select",l.list[b].ipv4AuthType)):l.list[b].pdpType===Number(r.ipv6)&&(a("#apnTypeSelect").dropdown("select",l.list[b].ipv6ApnType),a("#apnTypeSelect").val()===s.dynamic?(a("#apnInput").parent().hide(),a("#apnInput").val("")):(a("#apnInput").parent().show(),a("#apnInput").val(l.list[b].ipv6Apn)),a("#userNameInput").val(l.list[b].ipv6Username),a("#passwordInput").val(l.list[b].ipv6Password),a("#authTypeSelect").dropdown("select",l.list[b].ipv6AuthType)),a("#proListSelect").dropdown("pos")>=l.defaultProfile?(a("#proNameInput").attr("disabled",!1),a("#pdpTypeSelect").dropdown("enable"),a("#apnTypeSelect").dropdown("enable"),a("#apnInput").attr("disabled",!1),a("#userNameInput").attr("disabled",!1),a("#passwordInput").attr("disabled",!1),a("#authTypeSelect").dropdown("enable")):(a("#proNameInput").attr("disabled",!0),a("#pdpTypeSelect").dropdown("disable"),a("#apnTypeSelect").dropdown("disable"),a("#apnInput").attr("disabled",!0),a("#userNameInput").attr("disabled",!0),a("#passwordInput").attr("disabled",!0),a("#authTypeSelect").dropdown("disable")),a(".dialUpSection").validate("resetForm")}}),a("#apnTypeSelect").dropdown({onChanged:function(){a("#apnTypeSelect").val()===s.dynamic?a("#apnInput").parent().hide():a("#apnInput").parent().show(),a(".dialUpSection").validate("resetForm",null,!0)}}),a("#creApnTypeSelect").dropdown({onChanged:function(){a("#creApnTypeSelect").val()===s.dynamic?a("#creApnInput").parent().hide():(a("#creApnInput").parent().show(),a("#creApnInput").focus()),a(".createProfile").validate("resetForm",null,!0)}}),a("#deleteProfilePopup").popup({$closeButtons:a("#deleteCancelBtn")}),a("#errMessagePopup").popup({$closeButtons:a("#errOK")}),a("#useNewProfilePopup").popup({$closeButtons:a("#useCancelBtn")}),a.Validator.addRule("validCharInput",function(a){return isProfileInputCharValid(a)},a.i18n.prop("profileError")),a.Validator.addRule("validProfileName",function(a){return isProfileNameValid(a)},a.i18n.prop("profileEndErr")),a.Validator.addRule("sameProfileName",function(b){var c,d=0;for(c=0;c<l.list.length;c++)c!==a("#proListSelect").dropdown("pos")&&b===l.list[c].profileName&&d++;return d>0?!1:!0},a.i18n.prop("profileSameErr")),a.Validator.addRule("createSameProfileName",function(a){var b,c=0;for(b=0;b<l.list.length;b++)a===l.list[b].profileName&&c++;return c>0?!1:!0},a.i18n.prop("profileSameErr")),a(".dialUpSection").validate({rules:{proNameInput:{required:!0,validCharInput:!0,validProfileName:!0,sameProfileName:!0},apnInput:{required:!0,validCharInput:!0},userNameInput:{validCharInput:!0},passwordInput:{validCharInput:!0}}}),a(".createProfile").validate({rules:{creProNameInput:{required:!0,validCharInput:!0,validProfileName:!0,createSameProfileName:!0},creApnInput:{required:!0,validCharInput:!0},creUserNameInput:{required:!1,validCharInput:!0},crePasswordInput:{required:!1,validCharInput:!0}}})}function f(){a("#creProNameInput").val(""),a("#crePdpTypeSelect").dropdown("select",0),a("#creApnTypeSelect").dropdown("select",0),a("#creApnInput").val(""),a("#creUserNameInput").val(""),a("#crePasswordInput").val(""),a("#creAuthTypeSelect").dropdown("select",2)}function g(){callJSON(o,t.get_disconnet_reason,null,function(b){b.callFailReason===v.ROAM?(a("#disconnectedReason").text(a.i18n.prop("roamDisconnect")),window.setTimeout(g,1e4)):b.callFailReason===v.FLOWSTAT?a("#disconnectedReason").text(a.i18n.prop("flowstatDisconnect")):a("#disconnectedReason").text("")})}function h(b){var c={},d={};return isEqual(a("#mobileDataSwitch").switchButton("checked"),n)||(b.dataSwitchStatus=a("#mobileDataSwitch").switchButton("checked")),isEqual(a("#roamSwitch").switchButton("checked"),m)||(b.roamingEnabled=a("#roamSwitch").switchButton("checked")),a("#mobileDataSwitch").switchButton("checked")||a("#disconnectedReason").text(""),d.profileID=a("#proListSelect").dropdown("pos"),d.profileName=a("#proNameInput").val(),d.pdpType=a("#pdpTypeSelect").dropdown("pos"),a("#pdpTypeSelect").val()===r.ipv4||a("#pdpTypeSelect").val()===r.ipv4_ipv6?(d.ipv4Apn=a("#apnInput").val(),d.ipv4ApnType=a("#apnTypeSelect").dropdown("pos"),d.ipv4Username=a("#userNameInput").val(),d.ipv4Password=a("#passwordInput").val(),d.ipv4AuthType=a("#authTypeSelect").dropdown("pos"),d.ipv6Apn=l.list[a("#proListSelect").dropdown("pos")].ipv6Apn,d.ipv6ApnType=l.list[a("#proListSelect").dropdown("pos")].ipv6ApnType,d.ipv6Username=l.list[a("#proListSelect").dropdown("pos")].ipv6Username,d.ipv6Password=l.list[a("#proListSelect").dropdown("pos")].ipv6Password,d.ipv6AuthType=l.list[a("#proListSelect").dropdown("pos")].ipv6AuthType):a("#pdpTypeSelect").val()===r.ipv6&&(d.ipv4Apn=l.list[a("#proListSelect").dropdown("pos")].ipv4Apn,d.ipv4ApnType=l.list[a("#proListSelect").dropdown("pos")].ipv4ApnType,d.ipv4Username=l.list[a("#proListSelect").dropdown("pos")].ipv4Username,d.ipv4Password=l.list[a("#proListSelect").dropdown("pos")].ipv4Password,d.ipv4AuthType=l.list[a("#proListSelect").dropdown("pos")].ipv4AuthType,d.ipv6Apn=a("#apnInput").val(),d.ipv6ApnType=a("#apnTypeSelect").dropdown("pos"),d.ipv6Username=a("#userNameInput").val(),d.ipv6Password=a("#passwordInput").val(),d.ipv6AuthType=a("#authTypeSelect").dropdown("pos")),isEqual(d,l.list[l.activeProfile])||(c.list=[],c.list[0]=d,c.activeProfile=d.profileID,c.defaultProfile=l.defaultProfile,b.profileSettings=c),!0}function i(){callJSON(o,t.get_connect_status,null,function(b){0===b.result&&(b.connectStatus===Number(q.connected)&&a("#queryImg").is(":visible")&&(a("#queryImg").hide(),Settings.showToast("icon-saved",a.i18n.prop("connectedStatus"))),j(b),a("#save_err_message").text(""))})}function j(b){b.connectStatus===Number(q.disconnected)?(a("#connectBtn").text(a.i18n.prop("connectBtn")),a("#queryImg").hide(),u.timer1=window.setTimeout(i,1e4)):b.connectStatus===Number(q.connected)?(a("#connectBtn").text(a.i18n.prop("disconnBtn")),a("#queryImg").is(":visible")&&a("#queryImg").hide(),u.timer2=window.setTimeout(i,1e4)):b.connectStatus===Number(q.connecting)?(a("#connectBtn").text(a.i18n.prop("disconnBtn")),a("#queryImg").show(),u.timer3=window.setTimeout(i,5e3)):(a("#connectBtn").text(a.i18n.prop("disconnBtn")),a("#queryImg").show(),u.timer4=window.setTimeout(i,5e3))}function k(){a("#createProBtn").click(function(){return a("#proListSelect").find("option").length-l.defaultProfile===8?(a("#errMessage").text(a.i18n.prop("fullProfileErr")),a("#errMessagePopup").popup("show"),void 0):(a(".dialUpSection").hide(),f(),a("#create_err_message").text(""),a(".createProfile").show(),a("#creProNameInput").focus(),void 0)}),a("#createCancelBtn").click(function(){a(".createProfile").hide(),a("#save_err_message").text(""),a(".createProfile").validate("resetForm"),a(".dialUpSection").show()}),a("#deleteOKBtn").click(function(){var b={},c={},d={};a("#deleteProfilePopup").popup("hide"),a("#save_err_message").text(""),d.profileID=a("#proListSelect").dropdown("getRemovePos"),c.list=[],c.list[0]=d,b.profileSettings=c,b.profileSettings.activeProfile=l.activeProfile,b.profileSettings.defaultProfile=l.defaultProfile,callJSON(o,t.delete_Profile,b,function(b){0===b.result?(a("#proListSelect").dropdown("removeItem",a("#proListSelect").dropdown("getRemovePos")),loadPage("adv",["dialUpSettings"])):1===b.result&&Settings.showToast("icon-save-failed",a.i18n.prop("failedText"))})}),a("#useOKBtn").click(function(){var b,c={},d={};a("#useNewProfilePopup").popup("hide"),a("#crePdpTypeSelect").val()===r.ipv4||a("#crePdpTypeSelect").val()===r.ipv4_ipv6?b={profileID:l.list.length,profileName:a("#creProNameInput").val(),pdpType:a("#crePdpTypeSelect").dropdown("pos"),ipv4Apn:a("#creApnInput").val(),ipv4ApnType:a("#creApnTypeSelect").dropdown("pos"),ipv4Username:a("#creUserNameInput").val(),ipv4Password:a("#crePasswordInput").val(),ipv4AuthType:a("#creAuthTypeSelect").dropdown("pos"),ipv6Apn:"",ipv6ApnType:0,ipv6Username:"",ipv6Password:"",ipv6AuthType:2}:a("#crePdpTypeSelect").val()===r.ipv6&&(b={profileID:l.list.length,profileName:a("#creProNameInput").val(),pdpType:a("#crePdpTypeSelect").dropdown("pos"),ipv4Apn:"",ipv4ApnType:0,ipv4Username:"",ipv4Password:"",ipv4AuthType:2,ipv6Apn:a("#creApnInput").val(),ipv6ApnType:a("#creApnTypeSelect").dropdown("pos"),ipv6Username:a("#creUserNameInput").val(),ipv6Password:a("#crePasswordInput").val(),ipv6AuthType:a("#creAuthTypeSelect").dropdown("pos")}),d.list=[],d.list[0]=b,d.activeProfile=b.profileID,c.profileSettings=d,c.profileSettings.defaultProfile=l.defaultProfile,callJSON(o,t.add_Profile,c,function(b){0===b.result?loadPage("adv",["dialUpSettings"]):1===b.result&&Settings.showToast("icon-save-failed",a.i18n.prop("failedText"))})}),a("#connectBtn").click(function(){var b={},c=t.connect;if(a("#dialUpTypeSelect").val()===p.manual&&a("#connectBtn").text()===a.i18n.prop("disconnBtn")&&(c=t.disconnect),!(a("#proListSelect").dropdown("pos")>=l.defaultProfile&&!a(".dialUpSection").valid()||h(b)===!1)){for(var e in u)clearTimeout(u[e]);a("#connectBtn").text(a.i18n.prop("disconnBtn")),a("#queryImg").show(),callJSON(o,c,b,function(b){0===b.result&&(a("#save_err_message").text(""),getConfigJSON(o,d),window.setTimeout(i,2e3))})}}),a("#dialUpSaveBtn").click(function(){var b={};a("#proListSelect").dropdown("pos")>=l.defaultProfile&&!a(".dialUpSection").valid()||h(b)!==!1&&callJSON(o,t.set_Config,b,function(b){0===b.result?(a("#save_err_message").text(""),Settings.showSavedDialog(),getConfigJSON(o,d)):1===b.result&&Settings.showToast("icon-save-failed",a.i18n.prop("failedText"))})}),a("#createSaveBtn").click(function(){a(".createProfile").valid()&&a("#useNewProfilePopup").popup("show")})}var l,m,n,o="wan",p={manual:"0",auto:"1",demand:"2"},q={disable:0,disconnected:"1",connecting:"2",disconnecting:"3",connected:"4"},r={ipv4:"0",ipv6:"1",ipv4_ipv6:"2"},s={staticApn:"0",dynamic:"1"},t={get_Config:0,set_Config:1,add_Profile:2,delete_Profile:3,connect:4,disconnect:5,get_connect_status:6,get_disconnet_reason:11},u={},v={NORMAL:0,ROAM:1,FLOWSTAT:2};
a.dialUpSettings={onLoad:function(){b(),e(),c(),k()},onLeave:function(){for(var a in u)clearTimeout(u[a])}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#sms_panel-wrapper",["label","span","button"]),a.i18n.switchFont()}function c(b){if(0>b)return 1!==n&&(p=!0,i.pagination("toPage",n-1)),void 0;if(b>=j.length)return n!==o&&(p=!1,i.pagination("toPage",n+1)),void 0;k=b,1>=n&&0===k?a("#prevMessageBtn").addClass("disabled"):a("#prevMessageBtn").removeClass("disabled"),n>=o&&k===j.length-1?a("#nextMessageBtn").addClass("disabled"):a("#nextMessageBtn").removeClass("disabled");var c=j[b];a("#msgDetailNumber").text(c.to),a("#msgDetailText").text(c.content)}function d(b){h.nextAll().remove(),j=b.messageList,j&&0!==j.length?(a("#deleteDrafts").removeClass("disable"),a("#deleteDrafts").unbind("click").click(function(){h.nextAll().find("input:checked").length>0?a("#deletePopup").popup("show"):a("#deleteEmptyPopup").popup("show")})):(a("#deleteDrafts").addClass("disable"),a("#deleteDrafts").unbind("click"));var d="",e=0,f={};for(e=0;m>e&&e<j.length;e++)f=j[e],d+='<tr><td><label class="checkbox child"><input type="checkbox" id="index'+f.index+'"><span class="icon-unchecked"></span></label></td><td id="to'+f.index+'"></td><td class="sms-content" id="content'+f.index+'"></td></tr>';var g=a(d);for(h.after(g),e=0;m>e&&e<j.length;e++)f=j[e],a("#to"+f.index).text(f.to),a("#content"+f.index).text(f.content);g.find(".checkbox").checkbox(),g.find(".checkbox").click(function(){var b=0;g.find(".checkbox input").each(function(){a(this).prop("checked")&&b++,b===j.length?a("#selectAll").checkbox("setChecked",!0):a("#selectAll").checkbox("setChecked",!1)})}),g.click(function(b){0!==a(b.target).closest("td").prev().length&&(c(a(this).index()-1),a("#msgDetailContent").show(),a("#draftContent").hide())}),a("#msgDetailContent").is(":visible")&&(p?c(j.length-1):c(0)),o=Math.ceil(b.totalNumber/m),i.pagination("pageCount",o),a("#selectAll").checkbox("change",!1)}function e(a){var b={};b.pageNumber=a,b.amountPerPage=m,b.box=2,q!==!0&&(q=!0,callJSON(l,SMSACTION.READ_MSG,b,function(b){q=!1,d(b),n=a>o?o:a},function(){q=!1}))}function f(){var b=[];if(h.nextAll().find("input:checked").each(function(){b.push(parseInt(a(this).attr("id").substring(5),10))}),0!==b.length){var c={};c.box=2,c.deleteMessages=b,callJSON(l,SMSACTION.DELETE_MSG,c,function(b){i.pagination("refresh"),0===b.result?Settings.showSavedDialog(a.i18n.prop("deleteSuccessText")):Settings.showFailedDialog(a.i18n.prop("deleteFailedText"))})}}function g(){h=a("#draftsHeaderRow"),a("#selectAll").checkbox(".checkbox.child"),i=a("#draftsPagination"),i.pagination({onChanged:e}),a("#refreshDrafts").click(function(){a("#tableDrafts td").empty(),i.pagination("toPage",1)}),a("#deletePopup").popup({$closeButtons:a("#deleteCancel")}),a("#deleteOK").click(function(){a("#deletePopup").popup("hide"),f()}),a("#deleteEmptyPopup").popup({$closeButtons:a("#deleteEmptyOK")}),a("#deleteDrafts").click(function(){h.nextAll().find("input:checked").length>0?a("#deletePopup").popup("show"):a("#deleteEmptyPopup").popup("show")}),a("#smsBack").click(function(){a("#draftContent").show(),a("#msgDetailContent").hide()}),a("#smsEdit").click(function(){a("#msgDetailContent").hide(),a("#newMessageSection").show(),a.newMessage.editMessage(j[k])}),a("#prevMessageBtn").click(function(){c(k-1)}),a("#nextMessageBtn").click(function(){c(k+1)})}var h,i,j,k,l="message",m=8,n=0,o=0,p=!1,q=!1;a.drafts={onLoad:function(){b(),g()},onLeave:function(){j=null,n=o=0,q=!1}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#sms_panel-wrapper",["label","span","button"]),a.i18n.switchFont()}function c(b){if(0>b)return 1!==n&&(p=!0,i.pagination("toPage",n-1)),void 0;if(b>=j.length)return n!==o&&(p=!1,i.pagination("toPage",n+1)),void 0;k=b,1>=n&&0===k?a("#prevMessageBtn").addClass("disabled"):a("#prevMessageBtn").removeClass("disabled"),n>=o&&k===j.length-1?a("#nextMessageBtn").addClass("disabled"):a("#nextMessageBtn").removeClass("disabled");var c=j[b];if(a("#msgDetailNumber").text(c.from),a("#msgDetailDate").text(c.receivedTime),a("#msgDetailText").text(c.content),c.unread){var d={};d.markReadMessage=c.index,callJSON(l,SMSACTION.MARK_MSG,d),a("#tableInbox").children().children(":eq("+(b+1)+")").find(".icon-sms-unopened").attr("class","icon-sms-opened")}}function d(b){h.nextAll().remove(),j=b.messageList,j&&0!==j.length?(a("#deleteMessage").removeClass("disable"),a("#deleteMessage").unbind("click").click(function(){h.nextAll().find("input:checked").length>0?a("#deletePopup").popup("show"):a("#deleteEmptyPopup").popup("show")})):(a("#deleteMessage").addClass("disable"),a("#deleteMessage").unbind("click"));var d="",e=0,f={};for(e=0;m>e&&e<j.length;e++)f=j[e],d+='<tr><td><label class="checkbox child"><input type="checkbox" id="index'+f.index+'"><span class="icon-unchecked"></span></label></td><td><i class="icon-sms-'+(f.unread?"unopened":"opened")+'"></i></td><td id="from'+f.index+'"></td><td class="sms-content" id="content'+f.index+'"></td><td>'+f.receivedTime+"</td></tr>";var g=a(d);for(h.after(g),e=0;m>e&&e<j.length;e++)f=j[e],a("#from"+f.index).text(f.from),a("#content"+f.index).text(f.content);g.find(".checkbox").checkbox(),g.find(".checkbox").click(function(){var b=0;g.find(".checkbox input").each(function(){a(this).prop("checked")&&b++,b===j.length?a("#selectAll").checkbox("setChecked",!0):a("#selectAll").checkbox("setChecked",!1)})}),g.click(function(b){0!==a(b.target).closest("td").prev().length&&(c(a(this).index()-1),a("#msgDetailContent").show(),a("#inboxContent").hide())}),a("#msgDetailContent").is(":visible")&&(p?c(j.length-1):c(0)),o=Math.ceil(b.totalNumber/m),i.pagination("pageCount",o),a("#selectAll").checkbox("change",!1)}function e(a){var b={};b.pageNumber=a,b.amountPerPage=m,b.box=0,q!==!0&&(q=!0,callJSON(l,SMSACTION.READ_MSG,b,function(b){q=!1,d(b),n=a>o?o:a},function(){q=!1}))}function f(){var b=[];if(h.nextAll().find("input:checked").each(function(){b.push(parseInt(a(this).attr("id").substring(5),10))}),0!==b.length){var c={};c.box=0,c.deleteMessages=b,callJSON(l,SMSACTION.DELETE_MSG,c,function(b){i.pagination("refresh"),0===b.result?Settings.showSavedDialog(a.i18n.prop("deleteSuccessText")):Settings.showFailedDialog(a.i18n.prop("deleteFailedText"))})}}function g(){h=a("#inboxHeaderRow"),a("#selectAll").checkbox(".checkbox.child"),i=a("#inboxPagination"),i.pagination({onChanged:e}),a("#refreshInbox").click(function(){a("#tableInbox td").empty(),i.pagination("toPage",1)}),a("#deletePopup").popup({$closeButtons:a("#deleteCancel")}),a("#deleteOK").click(function(){a("#deletePopup").popup("hide"),f()}),a("#deleteEmptyPopup").popup({$closeButtons:a("#deleteEmptyOK")}),a("#deleteMessage").click(function(){h.nextAll().find("input:checked").length>0?a("#deletePopup").popup("show"):a("#deleteEmptyPopup").popup("show")}),a("#smsBack").click(function(){a("#inboxContent").show(),a("#msgDetailContent").hide()}),a("#smsReply").click(function(){a("#msgDetailContent").hide(),a("#newMessageSection").show(),a.newMessage.editMessage({to:a("#msgDetailNumber").text()})}),a("#smsForward").click(function(){a("#msgDetailContent").hide(),a("#newMessageSection").show(),a.newMessage.editMessage({content:a("#msgDetailText").text()})}),a("#prevMessageBtn").click(function(){c(k-1)}),a("#nextMessageBtn").click(function(){c(k+1)})}var h,i,j,k,l="message",m=8,n=0,o=0,p=!1,q=!1;a.inbox={onLoad:function(){b(),g()},onLeave:function(){j=null,n=o=0,q=!1}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#adv_panel-wrapper",["label","span","button"]),a.i18n.switchFont()}function c(){a.Validator.addRule("validUsername",function(a){return isValidUsername(a)},a.i18n.prop("invalidUsernameErr")),a.Validator.addRule("validPassword",function(a){return isValidPassword(a)},a.i18n.prop("invalidPasswordErr")),a.Validator.setErrorMessage("equalTo",a.i18n.prop("differentErr")),a(".loginPwdSection").validate({rules:{oldUsernameInput:{required:!0,validUsername:!0},oldPasswordInput:{required:!0,validPassword:!0},newUsernameInput:{required:!0,validUsername:!0},newPasswordInput:{required:!0,validPassword:!0},newPswConfirmInput:{required:!0,equalTo:"newPasswordInput"}},password:["newPasswordInput","newPswConfirmInput"]}),a("#newPasswordInput").keyup(function(){var b=checkPassword(a("#newPasswordInput").val()),c=isValidPassword(a("#newPasswordInput").val());c===!1?(a("#lowIndex").attr("class","icon-low-gray"),a("#middleIndex").attr("class","icon-middle-gray"),a("#highIndex").attr("class","icon-high-gray"),a("#passwordNote").hide()):(a("#passwordNote").show(),b>=70?(a("#lowIndex").attr("class","icon-low-gray"),a("#middleIndex").attr("class","icon-middle-gray"),a("#highIndex").attr("class","icon-high-green")):b>=50?(a("#lowIndex").attr("class","icon-low-gray"),a("#middleIndex").attr("class","icon-middle-orange"),a("#highIndex").attr("class","icon-high-gray")):b>0?(a("#lowIndex").attr("class","icon-low-red"),a("#middleIndex").attr("class","icon-middle-gray"),a("#highIndex").attr("class","icon-high-gray")):(a("#lowIndex").attr("class","icon-low-gray"),a("#middleIndex").attr("class","icon-middle-gray"),a("#highIndex").attr("class","icon-high-gray"))),a("#newPswConfirmInput").val()===a("#newPasswordInput").val()?""===a("#newPasswordInput").val()?a("#sameIndex").hide():a("#sameIndex").show():""!==a("#newPswConfirmInput").val()&&a("#sameIndex").hide()}),a("#newPswConfirmInput").keyup(function(){a("#newPswConfirmInput").val()===a("#newPasswordInput").val()?""===a("#newPasswordInput").val()?a("#sameIndex").hide():a("#sameIndex").show():a("#sameIndex").hide()}),a("#loginPswSave").click(function(){var b="authenticator",c={},d=4;a("#newPasswordInput").keyup(),a(".loginPwdSection").valid()&&(c.username=a("#oldUsernameInput").val(),c.newUsername=a("#newUsernameInput").val(),c.password=a("#oldPasswordInput").val(),c.newPassword=a("#newPasswordInput").val(),callJSON(b,d,c,function(b){0===b.result?(Settings.showSavedDialog(),a("input").val(""),a("#lowIndex").attr("class","icon-low-gray"),a("#middleIndex").attr("class","icon-middle-gray"),a("#highIndex").attr("class","icon-high-gray"),a("#sameIndex").hide()):1===b.result?(a("#errMessage").text(a.i18n.prop("authErr")),a("#errMessagePopup").popup("show")):2===b.result&&Settings.showToast("icon-save-failed",a.i18n.prop("failedText"))}))})}a.loginPsw={onLoad:function(){a("#sameIndex").hide(),b(),c(),a("#errMessagePopup").popup({$closeButtons:a("#errOK")})}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#adv_panel-wrapper",["label","span","button","option"]),a.i18n.switchFont()}function c(){getConfigJSON(h,d)}function d(b){switch(b.networkPreferredMode){case l.lte:a("#networkModeSelect").dropdown("select","3");break;case l.G4:a("#networkModeSelect").dropdown("select","2");break;case l.G3:a("#networkModeSelect").dropdown("select","1");break;default:a("#networkModeSelect").dropdown("select","3")}a("#networkSearchSelect").dropdown("select",""+b.networkSelectionMode),b.connectStatus===k.connected&&(n=1),1===b.cardType&&(a("#networkModeSelect").dropdown("removeItem",2),b.networkPreferredMode<=l.G3&&a("#networkModeSelect").dropdown("select","3")),b.networkSelectionMode===j.manual?a("#searchingTips").show():a("#searchingTips").hide(),a(".networkModeSection").show()}function e(){a("#coverDiv").css("position","static"),a("#networkModeSelect").dropdown(),a("#networkSearchSelect").dropdown({onChanged:function(){Number(a("#networkSearchSelect").val())===j.manual?a("#searchingTips").show():a("#searchingTips").hide()}}),a("#networkModeSave").click(function(){1===n?a("#disconnectPopup").popup("show"):f()}),a("#applyBtn").click(function(){var b={};return b.selectedOperator=a(".icon-radio-checked").next().text(),b.networkSelectionMode=a("#networkSearchSelect").dropdown("pos"),""===a(".icon-radio-checked").next().text()?(a("#list_err_message").text(a.i18n.prop("chooseNetworkWarn")),void 0):(a("#networkListPopup").popup("hide"),callJSON(h,i.setNetworkSelectionMode,b,function(b){0===b.result?(Settings.showWaitingDialog(a.i18n.prop("registeringText")),window.setTimeout(g,1e4)):1===b.result&&(a("#errMessage").text(a.i18n.prop("registerFailText")),a("#errMessagePopup").popup("show"))}),void 0)}),a("#disconnectPopup").popup({$closeButtons:a("#cancelBtn")}),a("#coninueBtn").click(function(){a("#disconnectPopup").popup("hide"),f()}),a("#errMessagePopup").popup({$closeButtons:a("#errOK")})}function f(){var b={};b.networkPreferredMode=Number(a("#networkModeSelect").val()),callJSON(h,i.set_config,b,function(b){if(0===b.result)if(a("#networkSearchSelect").dropdown("pos")===j.auto){var c={};c.networkSelectionMode=a("#networkSearchSelect").dropdown("pos"),callJSON(h,i.setNetworkSelectionMode,c,function(b){0===b.result?(Settings.showWaitingDialog(a.i18n.prop("savingText")),o=window.setTimeout(g,1e3)):1===b.result?(Settings.closeWaitingDialog(),Settings.showToast("icon-save-failed",a.i18n.prop("failedText"))):2===b.result&&Settings.showSavedDialog()})}else callJSON(h,i.quary_availabel_network,null,function(b){Settings.showWaitingDialog(a.i18n.prop("searchingText")),a("#coverDiv").css("position","fixed"),0===b.result&&(o=window.setTimeout(g,5e3))});else 1===b.result?Settings.showToast("icon-save-failed",a.i18n.prop("failedText")):2===b.result&&(a("#errMessage").text(a.i18n.prop("networkNoCardError")),a("#errMessagePopup").popup("show"))})}function g(){callJSON(h,i.get_network_selection_status,null,function(b){if(0===b.result)switch(b.networkSelectionStatus){case m.registering:o=window.setTimeout(g,3e3);break;case m.registered:Settings.closeWaitingDialog(),a("#coverDiv").css("position","static"),Settings.showToast("icon-saved",a.i18n.prop("registerSuccessful"));break;case m.searching:o=window.setTimeout(g,5e3);break;case m.searchFinish:if(Settings.closeWaitingDialog(),a("#coverDiv").css("position","static"),0===b.operatorList.length)a("#errMessage").text(a.i18n.prop("noNetworkErr")),a("#errMessagePopup").popup("show");else{var c;a("#networkListPopup").popup(),a("#list_err_message").text(""),a(".radioItem").remove();for(var d=b.operatorList.length-1;d>=0;d--){c=b.operatorList[d].operatorAlphaShort+" ("+b.operatorList[d].operatorState+")",""===b.operatorList[d].operatorAlphaShort&&(c=b.operatorList[d].operatorNumeric+" ("+b.operatorList[d].operatorState+")");var e='<div class="radioItem"><label class="radio"><input type="radio"><span class="icon-radio"></span><span class="hide">'+b.operatorList[d].operatorNumeric+"</span><span>"+c+"</span>",f=a(e);a(".headerContent").after(f)}a(".radio").radio(!0,".radio"),a("#networkListPopup").popup("show")}break;case m.search_generic_failure:Settings.closeWaitingDialog(),a("#coverDiv").css("position","static"),a("#errMessage").text(a.i18n.prop("searchFailText")),a("#errMessagePopup").popup("show");break;case m.register_generic_failure:Settings.closeWaitingDialog(),a("#coverDiv").css("position","static"),a("#errMessage").text(a.i18n.prop("registerFailText")),a("#errMessagePopup").popup("show");break;case m.register_denied_by_network:Settings.closeWaitingDialog(),a("#coverDiv").css("position","static"),a("#errMessage").text(a.i18n.prop("registerDeniedText")),a("#errMessagePopup").popup("show");break;case m.register_illegal_sim_or_me:Settings.closeWaitingDialog(),a("#coverDiv").css("position","static"),a("#errMessage").text(a.i18n.prop("registerIllegalText")),a("#errMessagePopup").popup("show");break;case m.saving:o=window.setTimeout(g,1e3);break;case m.saved:Settings.closeWaitingDialog(),Settings.showSavedDialog();break;default:Settings.closeWaitingDialog(),a("#coverDiv").css("position","static")}})}var h="wan",i={set_config:1,setNetworkSelectionMode:8,quary_availabel_network:9,get_network_selection_status:10},j={auto:0,manual:1},k={connected:4},l={lte:3,G4:2,G3:1},m={idle:0,registering:1,registered:2,searching:3,searchFinish:4,search_generic_failure:5,register_generic_failure:6,register_denied_by_network:7,register_illegal_sim_or_me:8,saving:9,saved:10},n=0,o=0;a.networkMode={onLoad:function(){b(),e(),c()},onLeave:function(){window.clearTimeout(o)}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#sms_panel-wrapper",["label","span","button"]),a.i18n.switchFont()}function c(){a.Validator.addRule("validPhoneNum",function(a){return isMobileNumValid(a)},a.i18n.prop("errMsgInvalidPhone")),a.Validator.addRule("countChars",function(){return d()},a.i18n.prop("errMsgCountExceed")),a("#newMessageSection").validate({rules:{nPhoneNumberInput:{required:!0,validPhoneNum:!0},nContentInput:{required:!0,countChars:!0}}})}function d(){var b,c=a("#nContentInput").val(),d=c.length;if(s>=d||j!==q){for(b=0;d>b;b++)if(c.charCodeAt(b)>=128){j=q;break}b===d&&(j=p)}c||(j=p),k=j,d>k&&(j===p?k=j-7:j===q&&(k=j-3));var e=d%k;m=0===e?d/k:(d-e+k)/k;var f=0===e&&m>0?e:k-e;return a("#wordCount").text(f+"/"+m),s=d,m>r?(c=c.substring(0,r*k),m=r,e=k,!1):!0}function e(){callJSON(n,SMSACTION.CHECK_SEND_RES,null,function(b){if(t++>=l)return a("#errMessage").text(a.i18n.prop("smsSendTimeout")),a("#errMessagePopup").popup("show"),Settings.closeWaitingDialog(),void 0;switch(b.result){case w.SENDING:setTimeout(e,3e3);break;case w.SEND_SUCC_SAVE_SUCC:a("#nPhoneNumberInput").val(""),a("#nContentInput").val(""),d(),o=null,Settings.showSavedDialog(a.i18n.prop("smsSent"));break;case w.SEND_SUCC_SAVE_FAIL:a("#errMessage").text(a.i18n.prop("smsSendSuccSaveFail")),a("#errMessagePopup").popup("show"),Settings.closeWaitingDialog();break;case w.SEND_FAIL_SAVE_SUCC:a("#errMessage").text(a.i18n.prop("smsSendFailSaveSucc")),a("#errMessagePopup").popup("show"),Settings.closeWaitingDialog();break;case w.SEND_FAIL_SAVE_FAIL:a("#errMessage").text(a.i18n.prop("smsSendFailSaveFail")),a("#errMessagePopup").popup("show"),Settings.closeWaitingDialog();break;default:a("#errMessage").text(a.i18n.prop("smsSendUnknownError")),a("#errMessagePopup").popup("show"),Settings.closeWaitingDialog()}})}function f(){var b=a("#nPhoneNumberInput").val(),c=a("#nContentInput").val();if(a("#newMessageSection").valid()){var d=new Date,f=[d.getFullYear(),d.getMonth()+1,d.getDate(),d.getHours(),d.getMinutes(),d.getSeconds()].join(","),g={};g.sendMessage={to:b,textContent:c,sendTime:f},o&&void 0!==o.index&&(g.sendMessage.index=o.index),callJSON(n,SMSACTION.SEND_MSG,g,function(b){0===b.result?(t=0,l=m>1?v:u,e()):(a("#errMessage").text(a.i18n.prop("smsSendUnknownError")),a("#errMessagePopup").popup("show"),Settings.closeWaitingDialog())}),Settings.showWaitingDialog(a.i18n.prop("smsSending"))}}function g(){var b=a("#nPhoneNumberInput").val(),c=a("#nContentInput").val();if(a("#newMessageSection").valid()){var e={};e.sendMessage={to:b,textContent:c},o&&void 0!==o.index&&(e.sendMessage.index=o.index),callJSON(n,SMSACTION.SAVE_MSG,e,function(b){0===b.result?(a("#nPhoneNumberInput").val(""),a("#nContentInput").val(""),d(),o=null,Settings.showSavedDialog(a.i18n.prop("savedText"))):Settings.showFailedDialog()}),Settings.showWaitingDialog(a.i18n.prop("savingText"))}}function h(){a("#smsSend").click(function(){f()}),a("#smsSave").click(function(){g()}),a("#nContentInput").bind("input propertychange blur change",d)}function i(){a("#newMessageSection").hide(),a("#newMessageHeader").hide(),a("#smsEditBack").show().click(function(){o=null,a("#nContentInput").val(""),a("#nPhoneNumberInput").val(""),a("#newMessageSection").hide(),a("#msgDetailContent").show(),d()})}var j,k,l,m,n="message",o=null,p=160,q=70,r=5,s=p,t=0,u=20,v=30,w={SEND_SUCC_SAVE_SUCC:0,SEND_SUCC_SAVE_FAIL:1,SEND_FAIL_SAVE_SUCC:2,SEND_FAIL_SAVE_FAIL:3,SENDING:4};a.newMessage={onLoad:function(){b(),a("#errMessagePopup").popup({$closeButtons:a("#errOK")}),c(),Settings.passedMsg?(o=Settings.passedMsg,Settings.passedMsg=null,void 0!==o.content?a("#nContentInput").val(o.content):a("#nContentInput").focus(),void 0!==o.to?a("#nPhoneNumberInput").val(o.to):a("#nPhoneNumberInput").focus()):o=null,h(),d(),a("#sms_panel-wrapper").children(".section").length>1&&i()},onLeave:function(){o=null},editMessage:function(b){o=b,void 0!==b.content?a("#nContentInput").val(b.content):a("#nContentInput").focus(),void 0!==b.to?a("#nPhoneNumberInput").val(b.to):a("#nPhoneNumberInput").focus(),d()}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#sms_panel-wrapper",["label","span","button"]),a.i18n.switchFont()}function c(b){if(0>b)return 1!==n&&(p=!0,i.pagination("toPage",n-1)),void 0;if(b>=j.length)return n!==o&&(p=!1,i.pagination("toPage",n+1)),void 0;k=b,1>=n&&0===k?a("#prevMessageBtn").addClass("disabled"):a("#prevMessageBtn").removeClass("disabled"),n>=o&&k===j.length-1?a("#nextMessageBtn").addClass("disabled"):a("#nextMessageBtn").removeClass("disabled");var c=j[b];a("#msgDetailNumber").text(c.to),a("#msgDetailDate").text(c.sendTime),a("#msgDetailText").text(c.content)}function d(b){h.nextAll().remove(),j=b.messageList,j&&0!==j.length?(a("#deleteMessage").removeClass("disable"),a("#deleteMessage").unbind("click").click(function(){h.nextAll().find("input:checked").length>0?a("#deletePopup").popup("show"):a("#deleteEmptyPopup").popup("show")})):(a("#deleteMessage").addClass("disable"),a("#deleteMessage").unbind("click"));var d="",e=0,f={};for(e=0;m>e&&e<j.length;e++)f=j[e],d+='<tr><td><label class="checkbox child"><input type="checkbox" id="index'+f.index+'"><span class="icon-unchecked"></span></label></td><td id="to'+f.index+'"></td><td class="sms-content" id="content'+f.index+'"></td><td>'+f.sendTime+"</td></tr>";var g=a(d);for(h.after(g),e=0;m>e&&e<j.length;e++)f=j[e],a("#to"+f.index).text(f.to),a("#content"+f.index).text(f.content);g.find(".checkbox").checkbox(),g.find(".checkbox").click(function(){var b=0;g.find(".checkbox input").each(function(){a(this).prop("checked")&&b++,b===j.length?a("#selectAll").checkbox("setChecked",!0):a("#selectAll").checkbox("setChecked",!1)})}),g.click(function(b){0!==a(b.target).closest("td").prev().length&&(c(a(this).index()-1),a("#msgDetailContent").show(),a("#outboxContent").hide())}),a("#msgDetailContent").is(":visible")&&(p?c(j.length-1):c(0)),o=Math.ceil(b.totalNumber/m),i.pagination("pageCount",o),a("#selectAll").checkbox("change",!1)}function e(a){var b={};b.pageNumber=a,b.amountPerPage=m,b.box=1,q!==!0&&(q=!0,callJSON(l,SMSACTION.READ_MSG,b,function(b){q=!1,d(b),n=a>o?o:a},function(){q=!1}))}function f(){var b=[];if(h.nextAll().find("input:checked").each(function(){b.push(parseInt(a(this).attr("id").substring(5),10))}),0!==b.length){var c={};c.box=1,c.deleteMessages=b,callJSON(l,SMSACTION.DELETE_MSG,c,function(b){i.pagination("refresh"),0===b.result?Settings.showSavedDialog(a.i18n.prop("deleteSuccessText")):Settings.showFailedDialog(a.i18n.prop("deleteFailedText"))})}}function g(){h=a("#outboxHeaderRow"),a("#selectAll").checkbox(".checkbox.child"),i=a("#outboxPagination"),i.pagination({onChanged:e}),a("#refreshOutbox").click(function(){a("#tableOutbox td").empty(),i.pagination("toPage",1)}),a("#deletePopup").popup({$closeButtons:a("#deleteCancel")}),a("#deleteOK").click(function(){a("#deletePopup").popup("hide"),f()}),a("#deleteEmptyPopup").popup({$closeButtons:a("#deleteEmptyOK")}),a("#deleteMessage").click(function(){h.nextAll().find("input:checked").length>0?a("#deletePopup").popup("show"):a("#deleteEmptyPopup").popup("show")}),a("#smsBack").click(function(){a("#outboxContent").show(),a("#msgDetailContent").hide()}),a("#smsForward").click(function(){a("#msgDetailContent").hide(),a("#newMessageSection").show(),a.newMessage.editMessage({content:a("#msgDetailText").text()})}),a("#prevMessageBtn").click(function(){c(k-1)}),a("#nextMessageBtn").click(function(){c(k+1)})}var h,i,j,k,l="message",m=8,n=0,o=0,p=!1,q=!1;a.outbox={onLoad:function(){b(),g()},onLeave:function(){j=null,n=o=0,q=!1}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#adv_panel-wrapper",["label","span","button","option"]),a.i18n.switchFont()}function c(){a.Validator.addRule("pinRequired",function(b){var c={};if(!b)switch(c.autoUnlock=a("#autoUnlockSwitch").switchButton("checked"),l.pinState){case n.notVerified:return c.autoUnlock!==l.autoUnlock&&l.autoUnlock===!0?!0:!1;case n.verified:var d=a("#pinManagementSelect").dropdown("value");if("0"===d)return c.autoUnlock!==l.autoUnlock?!0:!1;if("1"===d)return newPin=a("#newPinInput").val(),confirmPin=a("#confirmPinInput").val(),pin=a("#pinInput").val(),pin||newPin||confirmPin||c.autoUnlock===l.autoUnlock?!1:!0;case n.disabled:return c.autoUnlock!==l.autoUnlock&&l.autoUnlock===!0?!0:!1;case n.pukLock:if(puk=a("#pukInput").val(),newPin=a("#newPinInput").val(),confirmPin=a("#confirmPinInput").val(),!puk&&!newPin&&!confirmPin)return c.autoUnlock!==l.autoUnlock&&l.autoUnlock===!0?!0:!1}return!0},a.i18n.prop("required")),a.Validator.addRule("pinValid",function(a){return pinValid(a)},a.i18n.prop("pinInvalid")),a.Validator.addRule("pukValid",function(a){return pukValid(a)},a.i18n.prop("pukInvalid")),a.Validator.setErrorMessage("equalTo",a.i18n.prop("notSamePin")),a(".pinManagementSection").validate({rules:{pinInput:{pinRequired:!0,pinValid:!0},newPinInput:{pinRequired:!0,pinValid:!0},confirmPinInput:{pinRequired:!0,equalTo:"newPinInput"},pukInput:{pinRequired:!0,pukValid:!0}},password:["newPinInput","confirmPinInput"]}),a("#pinInput").keyup(function(){pinValid(a("#pinInput").val())===!0?a("#remainingPinAttemptsLbl").show():a("#remainingPinAttemptsLbl").hide()})}function d(b){a(".pinManagementSection input[type=text]").val(""),l&&2===l.pinState?0===b?a("#modifyPinDiv").slideUp("fast"):a("#modifyPinDiv").slideDown("fast"):a("#modifyPinDiv").hide()}function e(b,c){a("#SIMStatus").text(a.i18n.prop(b)),a(".pinManagementSection input[type=text]").val(""),c||(c={}),c.dropdown?a("#pinManagementDiv").show():a("#pinManagementDiv").hide(),c.pinInput?a("#pinInputDiv").show():a("#pinInputDiv").hide(),c.newPin||c.pinConfirm?a("#modifyPinDiv").show():a("#modifyPinDiv").hide(),c.pukInput?a("#pukInputDiv").show():a("#pukInputDiv").hide(),c.autoUnlock?a("#autoUnlockDiv").show():a("#autoUnlockDiv").hide(),c.buttonTextId?a("#pinManagementSave").text(a.i18n.prop(c.buttonTextId)):a("#pinManagementSave").text(a.i18n.prop("pinManagementSave"))}function f(){var b,c,d,e,f={},g=o.getConfig;if(l&&(a("#pinInput").keyup(),a(".pinManagementSection").valid())){if(l.cardState===m.present)switch(a("#autoUnlockDiv").is(":visible")&&(f.autoUnlock=a("#autoUnlockSwitch").switchButton("checked")),l.pinState){case n.notVerified:if(c=a("#pinInput").val(),!c){g=o.setAutoUnlock;break}f.pin=c,g=o.unlockPIN;break;case n.verified:var h=a("#pinManagementSelect").dropdown("value");if("0"===h){if(c=a("#pinInput").val(),!c&&f.autoUnlock!==l.autoUnlock){g=o.setAutoUnlock;break}f.pin=c,g=o.disablePIN}else if("1"===h){if(d=a("#newPinInput").val(),b=a("#confirmPinInput").val(),c=a("#pinInput").val(),!c&&!d&&!b&&f.autoUnlock!==l.autoUnlock){g=o.setAutoUnlock;break}f.pin=c,f.newPin=d,g=o.modifyPIN}break;case n.disabled:if(c=a("#pinInput").val(),!c&&f.autoUnlock!==l.autoUnlock&&l.autoUnlock===!0){g=o.setAutoUnlock;break}f.pin=c,g=o.enablePIN;break;case n.pukLock:if(e=a("#pukInput").val(),d=a("#newPinInput").val(),b=a("#confirmPinInput").val(),!e&&!d&&!b&&f.autoUnlock!==l.autoUnlock&&l.autoUnlock===!0){g=o.setAutoUnlock;break}f.puk=e,f.newPin=d,g=o.unlockPUK}callJSON("simLock",g,f,function(b){0===b.result?Settings.showSavedDialog(a.i18n.prop("pinSuccessText")):g===o.unlockPIN||g===o.enablePIN||g===o.disablePIN||g===o.modifyPIN?(a("#errMessage").text(a.i18n.prop("pinWrong")),a("#errMessagePopup").popup("show"),Settings.closeWaitingDialog()):g===o.unlockPUK?(a("#errMessage").text(a.i18n.prop("pukWrong")),a("#errMessagePopup").popup("show"),Settings.closeWaitingDialog()):Settings.showFailedDialog(a.i18n.prop("pinFailedText")),j(b),a(".pinManagementSection").validate("resetForm",null,!1)}),Settings.showWaitingDialog(a.i18n.prop("pinWaitText"))}}function g(){a("#autoUnlockSwitch").switchButton({onChanged:function(){a(".pinManagementSection").valid()}}),a("#pinManagementSave").click(function(){f()})}function h(b){a("#remainingPinAttemptsLbl").html(a.i18n.prop("remainingPinAttempts")+'<span class="remainingNumber">'+b+"</span>")}function i(b){a("#remainingPukAttemptsLbl").html(a.i18n.prop("remainingPukAttempts")+'<span class="remainingNumber">'+b+"</span>")}function j(b){var c;switch(b.pinRemainingTimes&&h(b.pinRemainingTimes),b.pukRemainingTimes&&i(b.pukRemainingTimes),b.cardState){case m.absent:e("noSim",{buttonTextId:"pinManagementRefresh"});break;case m.present:switch(b.pinState){case n.unknown:e("SIMStatusUnknown",{buttonTextId:"pinManagementRefresh"});break;case n.notVerified:e("SIMStatusPinLocked",{pinInput:!0,autoUnlock:!0}),a("#autoUnlockSwitch").switchButton("changeState",b.autoUnlock,!0);break;case n.verified:l&&l.pinState===b.pinState||(e("SIMStatusPinVerified",{dropdown:!0,pinInput:!0,autoUnlock:!0,autoUnlockPin:!0}),c=a("#pinManagementSelect"),c.dropdown("addItem",a.i18n.prop("pinDisableOpt"),0,0),c.dropdown("addItem",a.i18n.prop("pinModifyOpt"),1,1),c.dropdown("removeItem",3),c.dropdown("removeItem",2),c.dropdown("select",0)),a(".pinManagementSection input[type=text]").val(""),a("#autoUnlockSwitch").switchButton("changeState",b.autoUnlock,!0);break;case n.disabled:e("SIMStatusPinDisabled",{dropdown:!0,pinInput:!0,autoUnlock:!0}),c=a("#pinManagementSelect"),c.dropdown("addItem",a.i18n.prop("pinEnableOpt"),2,0),c.dropdown("removeItem",2),c.dropdown("removeItem",1),c.dropdown("select",0),a("#autoUnlockSwitch").switchButton("changeState",b.autoUnlock,!0);break;case n.pukLock:e("SIMStatusPukLocked",{pukInput:!0,newPin:!0,autoUnlock:!0}),a("#autoUnlockSwitch").switchButton("changeState",b.autoUnlock,!0);break;case n.blocked:e("SIMStatusBlocked",{buttonTextId:"pinManagementRefresh"});break;default:e("SIMStatusUnknown",{buttonTextId:"pinManagementRefresh"})}break;default:e("SIMStatusError",{buttonTextId:"pinManagementRefresh"})}l=b,a(".pinManagementSection").show()}function k(){getConfigJSON("simLock",j)}var l,m={absent:0,present:1,error:2},n={unknown:0,notVerified:1,verified:2,disabled:3,pukLock:4,blocked:5},o={getConfig:0,enablePIN:1,disablePIN:2,modifyPIN:3,unlockPIN:4,unlockPUK:5,setAutoUnlock:6};a.pinConfig={onLoad:function(){l=null,b(),g(),c(),a("#errMessagePopup").popup({$closeButtons:a("#errOK")}),a("#pinManagementSelect").dropdown({onChanged:d}),a("#autoUnlockSwitch").switchButton(),k()},onLeave:function(){l=null}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#adv_panel-wrapper",["label","span","button","option"]),a.i18n.switchFont(),a("#wifiRangeSelect").dropdown(),a("#wifiRebootPopup").popup({$closeButtons:a("#wifiRebootCancel")}),a("#rebootProgressPopup").popup({noXButton:!0})}function c(a){getConfigJSON(j,function(b){d(b,a)})}function d(b,c){p=a.extend({},b),c||(a("#powerSaveSwitch").switchButton("changeState",!!b.enable,!0),a("#wifiRangeSelect").dropdown("select",""+b.powerLevel),a("#sleepTime").val(b.autoDisableTime/60),a("#powerSaveSecCon").removeClass("hide"))}function e(){a.Validator.addRule("isSleepTime",function(){return is_integer(a("#sleepTime").val(),1,1e5)?!0:!1},a.i18n.prop("sleepTimeInvalid")),a("#powerSaveSecCon").validate({rules:{sleepTime:{required:!0,isSleepTime:!0}}})}function f(){var b={enable:p.enable},d=a("#powerSaveSwitch").switchButton("checked"),e=Number(a("#wifiRangeSelect").val()),f=void 0===p.powerLevel?!1:!0;return q=null,q={enable:d?1:0},d&&(q.autoDisableTime=60*a("#sleepTime").val(),b.autoDisableTime=p.autoDisableTime,f&&(q.powerLevel=e,b.powerLevel=p.powerLevel)),isEqual(b,q)?(Settings.showToast("icon-save-failed",a.i18n.prop("noChangeText")),void 0):(getConfigJSON(j,function(d){d.wlanOnOff===l.on&&f&&(b.enable===q.enable&&b.powerLevel!==q.powerLevel||b.enable!==q.enable&&(void 0!==q.powerLevel&&e!==m||void 0===q.powerLevel&&p.powerLevel!==m))?a("#wifiRebootPopup").popup("show"):callJSON(j,k,q,function(b){0===b.result?(Settings.showSavedDialog(),c()):(Settings.showToast("icon-save-failed",a.i18n.prop("failedText")),c(!0))})}),void 0)}function g(){a("#powerSaveSwitch").switchButton({onChanged:function(b){b?(void 0!==p.powerLevel&&a("#wifiRangeGroup").slideDown("fast"),a("#sleepTimeGroup").slideDown("fast")):(a("#wifiRangeGroup").slideUp("fast"),a("#sleepTimeGroup").slideUp("fast"))
}}).switchButton("change"),a("#powerSaveBtn").click(function(){a("#powerSaveSecCon").valid()&&f()}),a("#wifiRebootOK").click(function(){a("#wifiRebootPopup").popup("hide"),callJSON(j,k,q,function(b){0===b.result?(n=0,a("#rebootProgressPopup").popup("show"),i()):(clearTimeout(o),a("#rebootProgressPopup").popup("hide"),Settings.showToast("icon-save-failed",a.i18n.prop("failedText")),c(!0))})})}function h(){n&&(a("#progressBar").css("width",String(n/10)+"%"),a("#progressBar").text(parseInt(n/10)+"%"))}function i(){return n>1e3?(window.location.reload(),void 0):(1e3>=n&&(o=setTimeout(i,10),h(),n++),void 0)}var j="power_save",k=1,l={off:0,on:1},m=0,n=0,o=0,p={},q={};a.powerSaving={onLoad:function(){b(),g(),c(),e()}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#adv_panel-wrapper",["span","label","button"]),a.i18n.switchFont()}function c(){e&&(a("#progressBar").css("width",String(e/10)+"%"),a("#progressBar").text(parseInt(e/10)+"%"))}function d(){return e>1e3?(window.location.reload(),void 0):(1e3>=e&&(window.setTimeout(d,45),c(),e++),void 0)}var e=0;a.restoreConf={onLoad:function(){b(),a(".restore").click(function(){a("#restorePopup").popup("show")}),a("#restorePopup").popup({$closeButtons:a("#restoreCancel")}),a("#rebootProgressPopup").popup({noXButton:!0}),a("#restoreOK").click(function(){var b={},c=0;e=0,a("#restorePopup").hide(),a("#rebootProgressPopup").popup("show"),a("*").unbind(),d(),callJSON("restoreDefaults",c,b,function(){})})}}}(jQuery);var Settings={},WEB_MODULE="webServer",ACTION={GET_LANGUAGE:0,SET_LANGUAGE:1},$topMessage=$("#topMessage"),$topSignal=$("#topSignal"),$topNetType=$("#topNetType"),$topInternet=$("#topInternet"),$topElectricity=$("#topElectricity"),$topSdcard=$("#topSdcard"),$topWireless=$("#topWireless"),$topRoaming=$("#topRoaming"),NETWORKTYPE={0:[0,"No Service"],1:[2,"GSM"],2:[3,"WCDMA"],3:[4,"LTE"],4:[3,"TD-SCDMA"],5:[2,"CDMA 1x"],6:[3,"CDMA 1x Ev-Do"]};Settings.passedMsg=null,Settings.showSetPsw=!1,Settings.wireless=!1,Settings.dataSetting=!1,Settings.initHeader=function(){$.i18n.elementLocalization("#header",["option","span"]),$("#langSel").dropdown({onChanged:langSwitch}).dropdown("refreshText"),$("body").css("height",window.innerHeight),$("#content").css("min-height",window.innerHeight-parseInt($("#header").css("height"),10)),$(".logout").on({mouseenter:function(){$(this).children("i").attr("class","icon-logout-hover")},mouseleave:function(){$(this).children("i").attr("class","icon-logout")},mousedown:function(){$(this).css("color","#0071bc").children("i").attr("class","icon-logout-press")},mouseup:function(){$(this).removeAttr("style").children("i").attr("class","icon-logout-hover")},click:function(){doLogout()}})},Settings.tabNames=["Wizard","Status","SMS","Advanced"],Settings.tabs={Wizard:{onLoad:function(){$.wizard.onLoad(),$(".wizardPage").css("min-height",window.innerHeight-parseInt($("#header").css("height"),10)-70)}},Status:{onLoad:function(){$.status.onLoad(),$(".statusPage").css("min-height",window.innerHeight-parseInt($("#header").css("height"),10)-70)},onLeave:function(){$.status.onLeave()}},SMS:{onLoad:function(){createMenu("sms")},onLeave:function(){if(curMenuItems){for(var a=0;a<curMenuItems.length;a++){var b=$[curMenuItems[a]];b.onLeave&&b.onLeave()}curMenuItems=null}}},Advanced:{onLoad:function(){createMenu("adv")},onLeave:function(){if(curMenuItems){for(var a=0;a<curMenuItems.length;a++){var b=$[curMenuItems[a]];b.onLeave&&b.onLeave()}curMenuItems=null}}}},Settings.loadTabHTML=function(a){var b=++g_curPageID;$.ajax({type:"GET",url:a.toLowerCase()+".html",dataType:"html",success:function(c){if(b===g_curPageID){$("#container").empty().append(c);var d=Settings.currentTab;d&&Settings.tabs[d].onLeave&&Settings.tabs[d].onLeave(),Settings.currentTab=a,Settings.tabs[a].onLoad(),bindHelpEvent()}}})},Settings.updateTopIcons=function(){callJSON("status",0,null,function(a){if(a&&0===a.result){var b,c=a.wan.networkType;0===c?($topSignal.attr("class","icon-top-nosignal").closest("li").attr("title",NETWORKTYPE[c][1]),$topNetType.closest("li").hide()):($topSignal.attr("class","icon-top-signal"+a.wan.signalStrength).closest("li").attr("title",$.i18n.prop("titleSignalStrength")),4===a.wan.connectStatus?$topNetType.text(NETWORKTYPE[c][0]+"G").closest("li").attr("title",NETWORKTYPE[c][1]).show():$topNetType.closest("li").hide());var d=a.wan.roaming;1===d?$topRoaming.attr("class","icon-top-roaming").closest("li").attr("title",$.i18n.prop("titleRoaming")).show():$topRoaming.closest("li").hide();var e=a.message.unreadMessages;if(e>0?$topMessage.attr("class","top-digital icon-top-number"+(e>10?"N":e)).show():$topMessage.hide(),b=$.i18n.prop("titleMessageText").replace("_TEXT_",e),$topMessage.closest("li").attr("title",b),a.wlan.enable){$("#wifiStatus").removeClass("icon-top-wireless-down").addClass("icon-top-wireless");var f=a.connectedDevices.number;f>0?$topWireless.attr("class","top-digital icon-top-number"+(f>10?"N":f)).show():$topWireless.hide(),b=$.i18n.prop("titleClientCountText").replace("_TEXT_",f),$topWireless.closest("li").attr("title",b)}else $topWireless.hide(),$("#wifiStatus").removeClass("icon-top-wireless").addClass("icon-top-wireless-down"),$topWireless.closest("li").attr("title",$.i18n.prop("titleWifiDownText"));$topSdcard.attr("class","icon-top-"+(a.sdcard.status?"":"no")+"sdcard"),b=$.i18n.prop(a.sdcard.status?"titleSdcardPluggedText":"titleSdcardUnpluggedText"),$topSdcard.closest("li").attr("title",b),$topElectricity.attr("class",getElectricityCls(a)),b=a.battery.connected?a.battery.charging?100===a.battery.voltage?$.i18n.prop("titleBatteryChargeFull"):$.i18n.prop("titleBatteryChargingText").replace("_TEXT_",a.battery.voltage):$.i18n.prop("titleBatteryUsageText").replace("_TEXT_",a.battery.voltage):$.i18n.prop("titleBatteryUnplugText"),$topElectricity.closest("li").attr("title",b)}},void 0,void 0,void 0,!0)},Settings.defaultTabName="Status",Settings.currentTab=null;var _toastFadeInTime=600,_toastDisplayTime=700,_toastFadeOutTime=1e3;Settings.showToast=function(a,b){function c(){addPopupDialog(a,b),Settings.$popupDialog.fadeIn(_toastFadeInTime).queue(function(a){setTimeout(a,_toastDisplayTime)}).fadeOut(_toastFadeOutTime,removeSettingDialog)}Settings.$cover&&(Settings.$cover.remove(),Settings.$cover=null),Settings.$popupDialog?Settings.$popupDialog.fadeOut(_toastFadeOutTime,c):c()},Settings.showSavedDialog=function(a){Settings.showToast("icon-saved",a?a:$.i18n.prop("savedText"))},Settings.showFailedDialog=function(a){Settings.showToast("icon-save-failed",a?a:$.i18n.prop("failedText"))},Settings.closeWaitingDialog=function(){Settings.$popupDialog.fadeOut(400,removeSettingDialog)},Settings.showWaitingDialog=function(a){Settings.$popupDialog&&Settings.$popupDialog.stop().remove(),Settings.$popupDialog=$('<div class="popup-toast"><img src="images/loading.gif"><div class="text">'+(a?a:$.i18n.prop("savingText"))+"</div></div>"),Settings.$cover=$('<div class="cover transparent"/>').appendTo("body"),$(".panel-sections").append(Settings.$popupDialog)},Settings.initLanguage=function(){callJSON(WEB_MODULE,ACTION.GET_LANGUAGE,null,function(a){$("#langSel").val(a.language),$.i18n.setLocale(a.language)},null,null,!1)},$(function(){Settings.initLanguage(),Settings.initHeader(),setDocInfo(),$("#tabList").click(function(a){var b=$(a.target).closest("li"),c=$(this).children(".active");c.length&&c.removeClass("active"),b.addClass("active"),Settings.loadTabHTML(b.data("tabName"))});for(var a=0;a<Settings.tabNames.length;a++){var b=Settings.tabNames[a];$("#tab"+b).data("tabName",b)}$("#tab"+Settings.defaultTabName).click(),Settings.updateTopIcons(),setInterval(Settings.updateTopIcons,1e4)});var SMSACTION={GET_CONFIG:0,SET_CONFIG:1,READ_MSG:2,SEND_MSG:3,SAVE_MSG:4,DELETE_MSG:5,MARK_MSG:6,CHECK_SEND_RES:7},g_curPageID=0;!function(a){function b(){a.i18n.elementLocalization("#adv_panel-wrapper",["span","label","button"]),a.i18n.switchFont()}function c(){h&&(a("#progressBar").css("width",String(h/10)+"%"),a("#progressBar").text(parseInt(h/10)+"%"))}function d(){return h>1e3?(window.location.reload(),void 0):(1e3>=h&&(window.setTimeout(d,g),c(),h++),void 0)}function e(){return h>500?(window.location.reload(),void 0):(500>=h&&(window.setTimeout(e,g),f(),h++),void 0)}function f(){h&&(a("#progressBar").css("width",String(h/5)+"%"),a("#progressBar").text(parseInt(h/5)+"%"))}var g,h=0;a.shutdown={onLoad:function(){h=0,b(),a(".reboot").click(function(){a("#shutdownconfirmText").text(a.i18n.prop("rebootConfirmText")),a("#shutdownOK").text(a.i18n.prop("rebootBtn")),a("#shutdownPopup").popup("show")}),a(".powerOff").click(function(){a("#shutdownconfirmText").text(a.i18n.prop("powerOffConfirmText")),a("#shutdownOK").text(a.i18n.prop("powerOffBtn")),a("#shutdownPopup").popup("show")}),a("#shutdownPopup").popup({$closeButtons:a("#shutdownCancel")}),a("#rebootProgressPopup").popup({noXButton:!0}),a("#shutdownOK").click(function(){var b;a("#shutdownPopup").hide(),a(this).text()===a.i18n.prop("rebootBtn")?(b=0,g=35,h=0,a("#shutdownTitle").text(a.i18n.prop("rebootBtn")),a("#rebootProgressPopup").popup("show"),a("*").unbind(),d(),callJSON("reboot",b,null,function(){})):(b=1,g=10,h=0,a("#shutdownTitle").text(a.i18n.prop("powerOffBtn")),a("#rebootProgressPopup").popup("show"),a("*").unbind(),e(),callJSON("reboot",b,null,function(){}))})}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#sms_panel-wrapper",["label","span","button"]),a.i18n.switchFont()}function c(){a.Validator.addRule("validPhoneNum",function(a){return isMobileNumValid(a)},a.i18n.prop("errMsgInvalidPhone")),a(".smsSettingsSection").validate({rules:{messageCenterNumberInput:{required:!0,validPhoneNum:!0}}})}function d(){var b={},c={};if(c.messageCenter=a("#messageCenterSwitch").switchButton("checked"),c.messageCenter){if(!a(".smsSettingsSection").valid())return;c.messageCenterNumber=a("#messageCenterNumberInput").val()}b.settings=c,callJSON(f,SMSACTION.SET_CONFIG,b,function(a){0===a.result?Settings.showSavedDialog():Settings.showFailedDialog()}),Settings.showWaitingDialog()}function e(){getConfigJSON(f,function(b){var c=b.settings;return"undefined"==typeof c.messageCenter?(a("#messageCenterDiv").hide(),a("#messageCenterNumberDiv").hide(),a("#smsSettingsSave").hide(),a(".smsSettingsSection").before('<p style="margin-top: 9px;">'+a.i18n.prop("nothingToConfig")+"</p>"),void 0):(a("#messageCenterNumberInput").val("-1"===c.messageCenterNumber?"":c.messageCenterNumber),c.messageCenter?a("#messageCenterNumberDiv").show():a("#messageCenterNumberDiv").hide(),a("#messageCenterSwitch").switchButton("changeState",c.messageCenter,!0),a("#smsSettingsSave").click(d),a(".smsSettingsSection").show(),void 0)})}var f="message";a.smsSettings={onLoad:function(){b(),c(),a("#messageCenterSwitch").switchButton({onChanged:function(b){b?a("#messageCenterNumberDiv").slideDown("fast"):a("#messageCenterNumberDiv").slideUp("fast")}}),a("#smsReportSwitch").switchButton(),e()}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#adv_panel-wrapper",["span","label","button"]),a.i18n.switchFont()}function c(){getConfigJSON(p,d)}function d(b){a("#currentSwVer").text(b.firmwareVersion),b.hasNewVersion?(w=byte2MB(b.firmwareSize),a("#newFirmware").text(" "+b.latestVersion),a("#newFirmwareLink").attr("href",b.downloadUrl),a("#newFirmwareSize").text("("+w+"MB)"),a("#hasNewVersion").slideDown("fast"),o=b.releaseNote,q=1,a("#updateBtn").attr("disabled",!1)):q=0,a(".updateSection").show()}function e(){a(".radio").radio(!0,".radio"),a("#swUpdateViaServer").data("radio").setChecked(!0),a("#swUpdateLocally").radio("callback",function(){a(".serverPart").slideUp("fast"),a("#updateForm").slideDown("fast"),a("#updateBtn").attr("disabled",!0)}),a("#swUpdateViaServer").radio("callback",function(){a(".serverPart").slideDown("fast"),a("#updateForm").slideUp("fast"),a("#textfield").val(""),1===q?a("#updateBtn").attr("disabled",!1):a("#updateBtn").attr("disabled",!0)}),a("#checkNewBtn").click(function(){a("#queryImg").show(),a("#hasNewVersion").slideUp("fast"),a("#noNewVersion").slideUp("fast"),a("#checkNewBtn").attr("disabled",!0),a("#updateBtn").attr("disabled",!0),window.setTimeout(n,500)}),a("#swUpdateFileInput").change(function(){var b=a("#swUpdateFileInput").val();-1!==b.indexOf("C:\\fakepath\\")&&(b=b.substring(12)),""!==a("#swUpdateFileInput").val()&&a("#swUpdateLocally").data("radio").getChecked()?a("#updateBtn").attr("disabled",!1):""===a("#swUpdateFileInput").val()&&a("#updateBtn").attr("disabled",!0),a("#textfield").val(b)}),a("#updateBtn").click(function(){return a("#swUpdateLocally").data("radio").getChecked()&&!i()?(a("#errMessage").text(a.i18n.prop("fileTypeErr")),a("#errMessagePopup").popup("show"),void 0):(a("#updateConfirmPopup").popup("show"),void 0)}),a("#updateOKBtn").click(function(){a("#updateConfirmPopup").popup("hide"),a("#swUpdateLocally").data("radio").getChecked()?(r=0,j(),callJSON(p,x.clearCache,null,function(b){if(0===b.result){var c=AuthModel.getToken();a("#updateForm").attr("action","cgi-bin/qcmap_update_cgi?token="+c),a("#updateForm").submit(),k(),a("#localUpdatePopup").popup("show"),f()}else a("#errMessage").text(a.i18n.prop("clearCacheErr")),a("#errMessagePopup").popup("show")})):callJSON(p,x.serverUpdate,null,function(b){switch(b.result){case z.RESULT_OK:m(),a("#updatePauseBtn").show(),a("#serverUpdatePopup").popup("show");break;case z.RESULT_NET_ERROR:a("#errMessage").text(a.i18n.prop("networkErr")),a("#errMessagePopup").popup("show");break;case z.RESULT_VERSION_NEWESR:a("#errMessage").text(a.i18n.prop("alreadyNewestErr")),a("#errMessagePopup").popup("show");break;case z.RESULT_START_ERROR:a("#errMessage").text(a.i18n.prop("serverErr")),a("#errMessagePopup").popup("show")}})}),a("#releaseNoteLink").click(function(){var b,c,d=o.split("\n");a("#releaseContent").empty();for(var e=0;e<d.length;e++)b='<div class="releaseItem"><span>'+d[e]+"</span></div>",c=a(b),c.appendTo("#releaseContent");a("#releaseNotePopup").popup("show")}),a("#updatePauseBtn").click(function(){window.clearTimeout(t),callJSON(p,x.pauseLoad,null,function(){})}),a("#updateConfirmPopup").popup({$closeButtons:a("#updateCancelBtn")}),a("#serverUpdatePopup").popup({$closeButtons:a("#updatePauseBtn"),noXButton:!0}),a("#localUpdatePopup").popup({noXButton:!0}),a("#releaseNotePopup").popup(),a("#errMessagePopup").popup({$closeButtons:a("#errOK")})}function f(){u=window.setInterval(g,3e3)}function g(){callJSON(p,x.reqUploadPercentage,null,function(b){switch(b.result){case B.RESULT_OK:window.clearTimeout(t),window.clearInterval(u),callJSON(p,x.startUpgrade,null,function(b){0===b.result?(s=116e3/(1e3-r),a("#uploading").text(a.i18n.prop("upgrading")),l()):(a("#errMessage").text(a.i18n.prop("upgradeFailErr")),a("#errMessagePopup").popup("show"))});break;case B.RESULT_UPLOAD_FAILED:h(),a("#errMessage").text(a.i18n.prop("uploadFailErr")),a("#errMessagePopup").popup("show");break;case B.RESULT_RSA_FAILED:h(),a("#errMessage").text(a.i18n.prop("RSAVerifyFailedErr")),a("#errMessagePopup").popup("show");break;case B.RESULT_COM_FAILED:h(),a("#errMessage").text(a.i18n.prop("COMVerifyFailedErr")),a("#errMessagePopup").popup("show");break;case B.RESULT_IDLE:}})}function h(){r=0,a("#localUpdatePopup").popup("hide"),window.clearTimeout(t),window.clearInterval(u)}function i(){var b=a("#swUpdateFileInput").val().split(".").pop().toLowerCase();return-1!==a.inArray(b,["zip"])}function j(){r&&(a("#swUpdateLocally").data("radio").getChecked()?(a("#localProgressBar").css("width",String(r/10)+"%"),a("#localProgressBar").text(parseInt(r/10)+"%")):(a("#serverProgressBar").css("width",String(r/10)+"%"),a("#serverProgressBar").text(parseInt(r/10)+"%")))}function k(){600>=r?(t=window.setTimeout(k,300),j(),r++):800>=r?(t=window.setTimeout(k,1500),j(),r++):(h(),a("#errMessage").text(a.i18n.prop("uploadTimeoutErr")),a("#errMessagePopup").popup("show"))}function l(){return r>1e3?(window.location.reload(),void 0):(1e3>=r&&(t=window.setTimeout(l,s),j(),r++),void 0)}function m(){callJSON(p,x.reqLoadPercentage,null,function(b){switch(b.result){case A.RESULT_OK:b.percentage<100?(r=10*b.percentage,j(),byte2MB(b.downloadedSize)?a("#downloadSizeText").text(byte2MB(b.downloadedSize)+"/"+w+"MB"):a("#downloadSizeText").text(w+"MB"),a("#rxSpeed").text(speedShow(b.RXSpeed)),a("#rxSpeedDiv").show(),t=window.setTimeout(m,3e3)):(r=10*b.percentage,j(),a("#updatePauseBtn").hide(),a("#downloadSizeText").hide(),a("#rxSpeedDiv").hide(),window.clearTimeout(t),a("#loading").text(a.i18n.prop("upgrading")),callJSON(p,x.startUpgrade,null,function(b){0===b.result?(r=0,s=64,l()):(a("#serverUpdatePopup").popup("hide"),a("#errMessage").text(a.i18n.prop("upgradeFailErr")),a("#errMessagePopup").popup("show"))}));break;case A.RESULT_RSA_FAILED:r=10*b.percentage,j(),window.setTimeout(function(){a("#serverUpdatePopup").popup("hide"),window.clearTimeout(t),a("#errMessage").text(a.i18n.prop("RSAVerifyFailedErr")),a("#errMessagePopup").popup("show")},500);break;case A.RESULT_COM_FAILED:r=10*b.percentage,j(),window.setTimeout(function(){a("#serverUpdatePopup").popup("hide"),window.clearTimeout(t),a("#errMessage").text(a.i18n.prop("COMVerifyFailedErr")),a("#errMessagePopup").popup("show")},500);break;default:a("#serverUpdatePopup").popup("hide"),window.clearTimeout(t),a("#errMessage").text(a.i18n.prop("serverErr")),a("#errMessagePopup").popup("show")}})}function n(){callJSON(p,x.checkNew,null,function(b){switch(b.result){case y.RESULT_OK:1===b.hasNewVersion?(w=byte2MB(b.firmwareSize),a("#newFirmware").text(" "+b.latestVersion),a("#newFirmwareLink").attr("href",b.downloadUrl),a("#newFirmwareSize").text("("+w+"MB )"),a("#hasNewVersion").slideDown("fast"),o=b.releaseNote,q=1,a("#swUpdateViaServer").data("radio").getChecked()&&a("#updateBtn").attr("disabled",!1)):(a("#noNewVersion").slideDown("fast"),q=0);break;case y.RESULT_SERVER_ERROR:a("#errMessage").text(a.i18n.prop("serverErr")),a("#errMessagePopup").popup("show");break;case y.RESULT_NET_ERROR:a("#errMessage").text(a.i18n.prop("networkErr")),a("#errMessagePopup").popup("show");break;case y.RESULT_CHECKING:v=window.setTimeout(n,3e3)}b.result!==y.RESULT_CHECKING&&(a("#queryImg").hide(),a("#checkNewBtn").attr("disabled",!1),window.clearTimeout(v))})}var o,p="update",q=0,r=0,s=100,t=0,u=0,v=0,w=0,x={getConfig:0,checkNew:1,serverUpdate:2,pauseLoad:3,reqLoadPercentage:4,reqUploadPercentage:5,startUpgrade:6,clearCache:7},y={RESULT_OK:0,RESULT_ERROR:1,RESULT_SERVER_ERROR:2,RESULT_NET_ERROR:3,RESULT_CHECKING:4},z={RESULT_OK:0,RESULT_VERSION_NEWESR:1,RESULT_START_ERROR:2,RESULT_NET_ERROR:3},A={RESULT_OK:0,RESULT_GET_ERROR:1,RESULT_RSA_FAILED:2,RESULT_COM_FAILED:3},B={RESULT_OK:0,RESULT_UPLOAD_FAILED:1,RESULT_RSA_FAILED:2,RESULT_IDLE:3,RESULT_COM_FAILED:4};a.softwareUpdate={onLoad:function(){b(),e(),c()},onLeave:function(){window.clearInterval(u),window.clearTimeout(v),window.clearTimeout(t)}}}(jQuery),function(a){function b(){a.i18n.elementLocalization(".statusPage",["span","label","button","a"]),a.i18n.switchFont()}function c(b){if(b.wan.simStatus===k.pinReq||b.wan.simStatus===k.pukReq||b.wan.simStatus===k.permanentLock)return a("#statusContent").hide(),a(".checkbox").checkbox(),a(".checkbox").checkbox("setChecked",!0),n.setupListeners(),a("#errMessagePopup").popup({$closeButtons:a("#errOK")}),n.validateForm(),n.loadData(),a(".tabCover").css("z-index",1),a("#tabStatus").removeClass("active"),a(".pinSection").show(),a("#statusHelp").hide(),a("#pinHelp").show(),void 0;if(l=b.factoryDefault)return Settings.showSetPsw=!0,a("#tabWizard").click(),void 0;switch(a("#statusContent").show(),a("#statusHelp").show(),a("#pinHelp").hide(),h||(f=setInterval(d,1e4),h=!0),b.wan.connectStatus){case i.connected:a("#connectionStatus").text(a.i18n.prop("connectedStatus")).addClass("okLabel").removeClass("warnLabel"),a("#linkingImg").hide();break;case i.disconnected:a("#connectionStatus").text(a.i18n.prop("disconnectedStatus")).addClass("warnLabel").removeClass("okLabel"),a("#linkingImg").hide();break;case i.connecting:a("#connectionStatus").text(a.i18n.prop("connectingStatus")).removeClass("okLabel warnLabel"),a("#linkingImg").show();break;case i.disconnecting:a("#connectionStatus").text(a.i18n.prop("disconnectingStatus")).removeClass("okLabel warnLabel"),a("#linkingImg").show();break;default:a("#connectionStatus").text(a.i18n.prop("connectedStatus")).addClass("okLabel").removeClass("warnLabel"),a("#linkingImg").hide()}if(i.disconnected===b.wan.connectStatus||i.connecting===b.wan.connectStatus){switch(b.wan.simStatus){case k.invalid:a("#simStatus").text(a.i18n.prop("simInvalid")).addClass("warnLabel");break;case k.noSim:a("#simStatus").text(a.i18n.prop("noSim")).addClass("warnLabel");break;case k.error:a("#simStatus").text(a.i18n.prop("simErr")).addClass("warnLabel");break;case k.ready:a("#simStatus").text(a.i18n.prop("simReady")).removeClass("warnLabel");break;case k.pinReq:a("#simStatus").text(a.i18n.prop("pinReq")).removeClass("warnLabel");break;case k.pinVerified:a("#simStatus").text(a.i18n.prop("pinVerified")).removeClass("warnLabel");break;case k.pukReq:a("#simStatus").text(a.i18n.prop("pukReq")).removeClass("warnLabel");break;case k.permanentLock:a("#simStatus").text(a.i18n.prop("permanentLock")).addClass("warnLabel");break;default:a("#simStatus").text(a.i18n.prop("simInvalid")).addClass("warnLabel")}a("#networkType").parent().hide(),a("#simStatus").parent().show()}else{switch(b.wan.networkType){case j.noService:a("#networkType").text(a.i18n.prop("noService"));break;case j.lte:a("#networkType").text(a.i18n.prop("lteType"));break;case j.wcdma:a("#networkType").text(a.i18n.prop("wcdmaType"));break;case j.cdma1x:a("#networkType").text(a.i18n.prop("cdma1xType"));break;case j.cdmaevdo:a("#networkType").text(a.i18n.prop("cdmaevdoType"));break;case j.tdscdma:a("#networkType").text(a.i18n.prop("tdscdmaType"));break;case j.gsm:a("#networkType").text(a.i18n.prop("gsmType"));break;default:a("#networkType").text(a.i18n.prop("noService"))}a("#simStatus").parent().hide(),a("#networkType").parent().show()}b.wan.ipv4!=m?a("#ipv4Address").text(b.wan.ipv4):a("#ipv4Address").text(m),b.wan.ipv6!=m?(b.wan.ipv6.length<23?a("#ipv6Address").text(b.wan.ipv6):a("#ipv6Address").text(b.wan.ipv6.replace(/(.{20})/g,"$1 ")),a("#ipv6Address").parent().show()):a("#ipv6Address").parent().hide(),1===b.wan.roaming&&b.wan.roamingEnabled===!1&&a("#roamLimitTip").show(),a("#ssid").text(b.wlan.ssid),0===b.wlan.mode?a("#security").text(a.i18n.prop("notSecured")).addClass("warnLabel"):a("#security").text(a.i18n.prop("secured")).removeClass("warnLabel"),b.wlan.bandType?a("#wirelessBand").text("5GHz"):a("#wirelessBand").text("2.4GHz"),"NONE"===b.wlan.region&&a("#region").text(a.i18n.prop("notSet")).addClass("warnLabel"),a.each(region,function(c,d){return b.wlan.region===c?(a("#region").text(d.country),!1):void 0}),"UN"===b.deviceInfo.productRegion&&a("#region").parent().show(),a("#curClients").text(""+b.connectedDevices.number),b.wan.enablePaymentDay&&a("#totalDataLbl").text(a.i18n.prop("monthDataLbl"));var c=byteAdapt(b.wan.totalStatistics);a("#totalData").text(""+c[0]),a("#totalDataUnit").text(""+c[1]),2===b.wan.dataLimit?(a("#dataLimitTip").show(),a("#totalData").addClass("warnLabel")):a("#totalData").removeClass("warnLabel");var e=byteAdapt(b.wan.dailyStatistics);a("#dailyData").text(""+e[0]),a("#dailyDataUnit").text(""+e[1])}function d(){getConfigJSON(g,c)}function e(){a("#dialupLink").click(function(){a("#tabAdvanced").click()}),a("#wirelessLink").click(function(){Settings.wireless=!0,a("#tabAdvanced").click()}),a("#dataSettingsLink").click(function(){Settings.dataSetting=!0,a("#tabAdvanced").click()})}var f,g="status",h=!1,i={disable:0,disconnected:1,connecting:2,disconnecting:3,connected:4},j={noSevrice:0,gsm:1,wcdma:2,lte:3,tdscdma:4,cdma1x:5,cdmaevdo:6},k={invalid:0,noSim:1,error:2,ready:3,pinReq:4,pinVerified:5,pukReq:6,permanentLock:7},l=!1,m="0.0.0.0",n={simData:{},apiCardState:{absent:0,present:1,error:2},apiPinState:{unknown:0,notVerified:1,verified:2,disabled:3,pukLock:4,blocked:5},actions:{getConfig:0,enablePIN:1,disablePIN:2,modifyPIN:3,unlockPIN:4,unlockPUK:5,setAutoUnlock:6},setDivs:function(b,c){c||(c={}),c.pinInput?(a("#pinHeader").text(a.i18n.prop("pinReqTitle")),a("#pinInputDiv").show()):a("#pinInputDiv").hide(),c.pukInput?(a("#pinHeader").text(a.i18n.prop("pukReqTitle")),a("#pukInputDiv").show()):a("#pukInputDiv").hide(),c.autoUnlock?a("#autoUnlockDiv").show():a("#autoUnlockDiv").hide(),c.buttonTextId?(a("#pinHeader").text(a.i18n.prop("permanentLockTitle")),a("#pinManagementSave").hide()):a("#pinManagementSave").text(a.i18n.prop("pinManagementSave"))},validateForm:function(){a.Validator.addRule("pinValid",function(a){return pinValid(a)},a.i18n.prop("pinInvalid")),a.Validator.addRule("pukValid",function(a){return pukValid(a)},a.i18n.prop("pukInvalid")),a.Validator.setErrorMessage("equalTo",a.i18n.prop("notSamePin")),a(".pinSection").validate({rules:{pinInput:{required:!0,pinValid:!0},newPinInput:{required:!0,pinValid:!0},confirmPinInput:{required:!0,equalTo:"newPinInput"},pukInput:{required:!0,pukValid:!0},password:["newPinInput","confirmPinInput"]}})},postData:function(){var b,c,d,e,f={},g=n.actions.getConfig;if(n.simData&&a(".pinSection").valid()){if(n.simData.cardState===n.apiCardState.present)switch(n.simData.pinState){case n.apiPinState.notVerified:b=a("#pinInput").val(),f.pin=b,f.autoUnlock=a("#autoUnlockChk").prop("checked"),g=n.actions.unlockPIN;break;case n.apiPinState.pukLock:e=a("#pukInput").val(),c=a("#newPinInput").val(),d=a("#confirmPinInput").val(),f.puk=e,f.newPin=c,g=n.actions.unlockPUK}callJSON("simLock",g,f,function(b){return 0===b.result?(a(".tabCover").css("z-index",-1),l?(Settings.showSetPsw=!0,a("#tabWizard").click()):a("#tabStatus").click(),void 0):(g===n.actions.unlockPIN?(a("#pin_err_message").text(a.i18n.prop("pinWrong")),a("#errMessagePopup").popup("show")):g===n.actions.unlockPUK?(a("#pin_err_message").text(a.i18n.prop("pukWrong")),a("#errMessagePopup").popup("show")):Settings.showFailedDialog(a.i18n.prop("pinFailedText")),n.setContent(b),void 0)})}},setupListeners:function(){a("#pinManagementSave").click(function(){n.postData()})},setPinAttempts:function(b){a("#remainingPinAttemptsLbl").html(a.i18n.prop("remainingPinAttempts")+'<span class="remainingNumber">'+b+"</span>")},setPukAttempts:function(b){a("#remainingPukAttemptsLbl").html(a.i18n.prop("remainingPukAttempts")+'<span class="remainingNumber">'+b+"</span>")},setContent:function(b){if(n.simData=b,b.pinRemainingTimes&&n.setPinAttempts(b.pinRemainingTimes),b.pukRemainingTimes&&n.setPukAttempts(b.pukRemainingTimes),b.cardState!==n.apiCardState.present)return a(".pinSection").hide(),a("#tabStatus").click(),void 0;switch(b.pinState){case n.apiPinState.notVerified:n.setDivs("SIMStatusPinLocked",{pinInput:!0,autoUnlock:!0});break;case n.apiPinState.pukLock:n.setDivs("SIMStatusPukLocked",{pukInput:!0});break;case n.apiPinState.blocked:n.setDivs("SIMStatusBlocked",{buttonTextId:"pinManagementRefresh"});break;default:return a(".pinSection").hide(),a("#tabStatus").click(),void 0}},loadData:function(){getConfigJSON("simLock",n.setContent)}};a.status={onLoad:function(){b(),loadHelpPage("status"),d(),e()},onLeave:function(){h&&(clearInterval(f),h=!1)}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#adv_panel-wrapper",["label","span","button","option","a"]),a.i18n.switchFont()}function c(b){var c=b.logList;c||(c=[]),c&&0!==c.length?(a("#clearLog").removeClass("disable"),a("#clearLog").unbind("click").click(function(){a("#clearLogConfirmPopup").popup("show")})):(a("#clearLog").addClass("disable"),a("#clearLog").unbind("click"));for(var d="",e=0;e<c.length;e++){var f=c[e];d+="<tr><td>"+(m*(l-1)+e+1)+"</td><td>"+f.time+"</td><td>"+n[f.type]+"</td><td>"+o[f.level]+'</td><td class="log-content">'+f.content+"</td></tr>"}a("#sysLogHeaderRow").nextAll().remove(),a("#sysLogHeaderRow").after(d),a("#sysLogPagination").pagination("pageCount",b.totalNumber/m)}function d(b){if(j)return j=!1,callJSON(k,5,null,function(b){b.mdLogState===p.off||b.mdLogState===p.on?(a("#mdLogSwitch").switchButton("changeState",b.mdLogState,!0,!0),a(".mdlog").show()):b.mdLogState===p.notSupport&&a(".mdlog").hide()}),f(),void 0;var d={};1>b&&(b=1),d.amountPerPage=m,d.pageNumber=b,d.type=a("#logTypeSelect").dropdown("pos"),d.level=a("#logLevelSelect").dropdown("pos"),callJSON(k,0,d,c),l=b}function e(){a("#sysLogPagination").pagination("toPage",1)}function f(){a("#tableSysLog td").empty(),callJSON(k,3,null,function(){a("#sysLogPagination").pagination("toPage",1)})}function g(){callJSON(k,1,null,e)}function h(){var b="cgi-bin/cgiLogDownload",c=callJSON(k,2,null,null,void 0,void 0,!1);return 0===c.result?(a("#downloadLogLink").attr("href",b+"?token="+AuthModel.getToken()),!0):!1}function i(b){callJSON(k,4,{mdLogState:b},function(b){0===b.result?Settings.showSavedDialog():(Settings.showFailedDialog(),1===b.result?a("#errMessage").text(a.i18n.prop("logNoSDCard")).show():2===b.result?a("#errMessage").text(a.i18n.prop("logSDCardWrongMode")).show():a("#errMessage").text(a.i18n.prop("logUnknownError")).show(),callJSON(k,4,null,function(b){a("#mdLogSwitch").switchButton("changeState",b.mdLogState,!0,!0)}))}),a("#errMessage").hide(),b?Settings.showWaitingDialog(a.i18n.prop("logOpeningMdLog")):Settings.showWaitingDialog(a.i18n.prop("logClosingMdLog"))}var j,k="log",l=1,m=8,n={1:"WLAN",2:"DHCP",3:"4G",4:"SMS",5:"SYSTEM",6:"OTHER"},o={1:"INFO",2:"NOTICE",3:"WARNING",4:"ERROR"},p={off:0,on:1,notSupport:2};a.sysLog={onLoad:function(){b(),j=!0,a(".mdlog").hide(),a("#logTypeSelect").dropdown({onChanged:e}),a("#logLevelSelect").dropdown({onChanged:e}),a("#sysLogPagination").pagination({onChanged:d}),a("#mdLogSwitch").switchButton({onChanged:i}),a("#clearLogConfirmPopup").popup({$closeButtons:a("#clearCancel")}),a("#clearOK").click(function(){a("#clearLogConfirmPopup").popup("hide"),g()}),a("#clearLog").click(function(){a("#clearLogConfirmPopup").popup("show")}),a("#refreshLog").click(f),a("#downloadLogLink").click(h)}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#adv_panel-wrapper",["label","span","button"]),a.i18n.switchFont()}function c(){a("#timeZoneSelect").dropdown({width:"400px",onChanged:function(){newSelectedValue=Number(a("#timeZoneSelect").val()),h+=60*(i-newSelectedValue)*1e3,i=newSelectedValue}})}function d(){getConfigJSON(j,e)}function e(b){var c=b.hour,d=b.minute,e=b.second;10>c&&(c="0"+c),10>d&&(d="0"+d),10>e&&(e="0"+e),a("#timeZoneSelect").dropdown("select",Number(b.id)),a("#dataSpan").text(b.year+"/"+b.month+"/"+b.date),a("#timeSpan").text(c+":"+d+":"+e),i=Number(a("#timeZoneSelect").val()),clearInterval(k);var g=new Date(b.year,b.month-1,b.date,b.hour,b.minute,b.second);h=g.getTime()+1e3,k=setInterval(f,1e3),a(".timeSettingsSection").show()}function f(){var b=new Date(h),c=b.getFullYear(),d=b.getMonth(),e=b.getDate(),f=b.getHours(),g=b.getMinutes(),i=b.getSeconds();h+=1e3,a("#dataSpan").text(c+"/"+(d+1)+"/"+e),10>f&&(f="0"+f),10>g&&(g="0"+g),10>i&&(i="0"+i),a("#timeSpan").text(f+":"+g+":"+i)}function g(){a("#timeSaveBtn").click(function(){var b={},c=1;b.id=a("#timeZoneSelect").dropdown("pos")+"",b.timeZone=a("#timeZoneSelect").val(),callJSON(j,c,b,function(a){0===a.result&&(Settings.showSavedDialog(),getConfigJSON(j,e))})})}var h,i,j="time",k=0;a.timeSettings={onLoad:function(){b(),c(),d(),g()},onLeave:function(){clearInterval(k)}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#adv_panel-wrapper",["label","span","button","option"]),a.i18n.switchFont()}function c(){getConfigJSON(j,e),getConfigJSON("status",function(b){"UN"===b.deviceInfo.productRegion&&(a("#regionSelect").parent().parent().show(),a("#regionHelpInfo").show()),r=1===b.wlan.enable?!0:!1})}function d(){a("#broadcastSwitch").switchButton(),a("#wirelessModeSelect").dropdown(),a("#channelSelect").dropdown({onChanged:function(){"14"===a("#channelSelect").val()?(a("#wirelessModeSelect").dropdown("select",""+m.mode_11bg),a("#wirelessModeSelect").dropdown("disable")):a("#wirelessModeSelect").dropdown("enable")
}}),a("#wirelessBandSelect").dropdown({onChanged:function(){for(var b=a("#wirelessModeSelect").find("option").length;b>0;b--)a("#wirelessModeSelect").dropdown("removeItem",b);for(b=a("#channelSelect").find("option").length;b>0;b--)a("#channelSelect").dropdown("removeItem",b);if(a("#wirelessBandSelect").val()===l.shortBand){for(a("#wirelessModeSelect").dropdown("addItem",a.i18n.prop("mode11bgMixedOpt"),m.mode_11bg,1),a("#wirelessModeSelect").dropdown("addItem",a.i18n.prop("mode11bgnMixedOpt"),m.mode_11bgn,2),b=region[a("#regionSelect").val()].shortBandBegin;b<=region[a("#regionSelect").val()].shortBandEnd;b++)a("#channelSelect").dropdown("addItem",b,b,b);a("#wirelessModeSelect").dropdown("select",""+m.mode_11bgn)}else{for(a("#wirelessModeSelect").dropdown("addItem",a.i18n.prop("mode11anMixedOpt"),m.mode_11an,1),b=0;b<region[a("#regionSelect").val()].longBand.length;b++)a("#channelSelect").dropdown("addItem",region[a("#regionSelect").val()].longBand[b],region[a("#regionSelect").val()].longBand[b],b+1);a("#wirelessModeSelect").dropdown("select",""+m.mode_11an)}}}),a("#regionSelect").dropdown({onChanged:function(){for(q&&h.expectRegion&&a("#regionSelect + .dropdown-toggle").text()!==region[h.expectRegion].country&&(a("#expectedRegionTips").hide(),a("#regionSelect").parent().removeClass("open")),i=a("#channelSelect").find("option").length;i>0;i--)a("#channelSelect").dropdown("removeItem",i);if(0===region[a("#regionSelect").val()].longBand.length&&0!==region[a("#regionSelect").val()].shortBandEnd)a("#wirelessBandSelect").dropdown("select",l.shortBand),a("#wirelessBandSelect").dropdown("change"),a("#wirelessBandSelect").dropdown("disable");else if(0===region[a("#regionSelect").val()].shortBandEnd&&region[a("#regionSelect").val()].longBand.length>0)a("#wirelessBandSelect").dropdown("select",l.longBand),a("#wirelessBandSelect").dropdown("change"),a("#wirelessBandSelect").dropdown("disable");else if(a("#wirelessBandSelect").dropdown("enable"),a("#wirelessBandSelect").val()===l.shortBand)for(i=region[a("#regionSelect").val()].shortBandBegin;i<=region[a("#regionSelect").val()].shortBandEnd;i++)a("#channelSelect").dropdown("addItem",i,i,i);else for(i=0;i<region[a("#regionSelect").val()].longBand.length;i++)a("#channelSelect").dropdown("addItem",region[a("#regionSelect").val()].longBand[i],region[a("#regionSelect").val()].longBand[i],i+1)}}),a("#securitySelect").dropdown({onChanged:function(){a("#securitySelect").val()===k.noSecurity?a("#keyInput").parent().hide():(a("#keyInput").val(h.mixed.key),a("#keyInput").parent().show()),a(".wifiSettingsSection").validate("resetForm",keyInput,!1)}}),a("#wirelessSettingsSave").click(function(){var b={};if(a(".wifiSettingsSection").valid())return a("#regionSelect").dropdown("text")===a.i18n.prop("selectRegion")?(a("#regionSelect").parent().addClass("open"),a("#errMessage").text(a.i18n.prop("regionErr")),a("#errMessagePopup").popup("show"),!1):(n={},n=a.extend({},h),n.ssid=a("#ssidInput").val(),n.ssidBcast=a("#broadcastSwitch").switchButton("checked"),n.region=a("#regionSelect").val(),n.wirelessMode=Number(a("#wirelessModeSelect").val()),n.channel=Number(a("#channelSelect").val()),n.securityMode=a("#securitySelect").dropdown("pos"),n.securityMode===Number(k.wpaMixedSecurity)?(b.key=a("#keyInput").val(),b.mode=1):(b.key="",b.mode=3),n.mixed=b,n.bandType=a("#wirelessBandSelect").dropdown("pos"),isEqual(n,h)&&!q?(Settings.showToast("icon-save-failed",a.i18n.prop("noChangeText")),void 0):(getConfigJSON("status",function(b){1===b.wlan.enable?a("#wifiRebootPopup").popup("show"):callJSON(j,1,n,function(b){0===b.result?(Settings.showSavedDialog(),c()):1===b.result&&Settings.showToast("icon-save-failed",a.i18n.prop("failedText"))})}),void 0))}),a("#wifiRebootOK").click(function(){var b=1;a("#wifiRebootPopup").popup("hide"),callJSON(j,b,n,function(b){0===b.result?(o=0,a("#expectedRegionTips").hide(),a("#rebootProgressPopup").popup("show"),g()):1===b.result&&(window.clearTimeout(p),a("#rebootProgressPopup").popup("hide"),Settings.showToast("icon-save-failed",a.i18n.prop("failedText")))})}),a("#wifiRebootPopup").popup({$closeButtons:a("#wifiRebootCancel")}),a("#rebootProgressPopup").popup({noXButton:!0}),a("#errMessagePopup").popup({$closeButtons:a("#errOK")}),a.Validator.addRule("validSSIDInput",function(a){return checkSsidSanity(a)},a.i18n.prop("invalidSSIDErr")),a.Validator.addRule("validKeyInput",function(a){return checkWlanKeySanity(a)},a.i18n.prop("invalidKeyErr")),a.Validator.addRule("validLengthKey",function(){return a("#keyInput").val().length<8?!1:!0},a.i18n.prop("shortKeyErr")),a.Validator.addRule("validHexKeyInput",function(){if(64===a("#keyInput").val().length)for(var b,c="0123456789ABCDEFabcdef",d=0;64>d;d++)if(b=a("#keyInput").val().charAt(d),-1===c.indexOf(b))return!1;return!0},a.i18n.prop("hexadecimalErr")),a(".wifiSettingsSection").validate({rules:{ssidInput:{required:!0,validSSIDInput:!0},keyInput:{required:!0,validKeyInput:!0,validLengthKey:!0,validHexKeyInput:!0}}})}function e(b){var c;if(h=null,h=b,a("#ssidInput").val(b.ssid),a("#broadcastSwitch").switchButton("changeState",b.ssidBcast,!0),a("#keyInput").val(b.mixed.key),a("#channelSelect").dropdown("addItem",a.i18n.prop("autoChannelOpt"),0,0),a("#expectedRegionTips").hide(),a("#regionSelect").parent().removeClass("open"),"NONE"===b.region?(q=!0,b.expectRegion?(a("#regionSelect").dropdown("select",b.expectRegion),b.region=b.expectRegion,a("#expectedRegionTips").show(),a("#regionSelect").parent().addClass("open")):(a("#regionSelect").dropdown("select","US"),b.region="US",a("#regionSelect + .dropdown-toggle").text(a.i18n.prop("selectRegion")))):a("#regionSelect").dropdown("select",b.region),a("#regionSelect").dropdown("change"),0===b.bandType){for(c=region[b.region].shortBandBegin;c<=region[b.region].shortBandEnd;c++)a("#channelSelect").dropdown("addItem",c,c,c);a("#wirelessModeSelect").dropdown("addItem",a.i18n.prop("mode11nOnlyOpt"),m.mode_11n,0),a("#wirelessModeSelect").dropdown("addItem",a.i18n.prop("mode11bgMixedOpt"),m.mode_11bg,1),a("#wirelessModeSelect").dropdown("addItem",a.i18n.prop("mode11bgnMixedOpt"),m.mode_11bgn,2)}else 0!==region[b.region].longBand.length&&a.each(region[b.region].longBand,function(b,c){a("#channelSelect").dropdown("addItem",c,c,b+1)}),a("#wirelessModeSelect").dropdown("addItem",a.i18n.prop("mode11nOnlyOpt"),m.mode_11n,0),a("#wirelessModeSelect").dropdown("addItem",a.i18n.prop("mode11anMixedOpt"),m.mode_11an,1);a("#wirelessBandSelect").dropdown("select",b.bandType),a("#wirelessBandSelect").dropdown("change"),a("#wirelessModeSelect").dropdown("select",""+b.wirelessMode),a("#channelSelect").dropdown("select",""+b.channel),a("#securitySelect").dropdown("select",b.securityMode),0===b.securityMode&&a("#keyInput").parent().hide(),a(".wifiSettingsSection").show()}function f(){o&&(a("#progressBar").css("width",String(o/10)+"%"),a("#progressBar").text(parseInt(o/10)+"%"))}function g(){return o>1e3?(window.location.reload(),void 0):(1e3>=o&&(p=window.setTimeout(g,10),f(),o++),void 0)}var h,j="wlan",k={noSecurity:"0",wpaMixedSecurity:"1"},l={shortBand:"0",longBand:"1"},m={mode_11n:3,mode_11bg:4,mode_11bgn:5,mode_11an:6},n={},o=0,p=0,q=!1,r=!0;a.wirelessSettings={onLoad:function(){b(),d(),c()}}}(jQuery),function(a){function b(){a.i18n.elementLocalization(".wizardPage",["span","label","button","option"]),a.i18n.switchFont()}function c(){a("#dialupHelp").show(),a("#finishHelp").hide(),a("#wirelessHelp").hide()}function d(){a("#dialupHelp").hide(),a("#finishHelp").hide(),a("#wirelessHelp").show()}function e(){a("#dialupHelp").hide(),a("#finishHelp").show(),a("#wirelessHelp").hide()}var f={moduleName:"wan",proList:{},creSaveFlag:!1,pdpType:{ipv4:"0",ipv6:"1",ipv4_ipv6:"2"},apnType:{staticApn:"0",dynamic:"1"},action:{get_Config:0,set_Config:1,wzd_Add_Profile:7},setContent:function(){getConfigJSON(f.moduleName,f.loadData),loadHelpPage("wizard")},loadData:function(b){for(f.proList=b.profileSettings,c=a("#proListSelect").find("option").length;c>=0;c--)a("#proListSelect").dropdown("removeItem",c);for(var c=0;c<b.profileSettings.list.length;c++)a("#proListSelect").dropdown("addItem",b.profileSettings.list[c].profileName,c,c);f.creSaveFlag?(a("#proListSelect").dropdown("select",b.profileSettings.list.length-1),f.creSaveFlag=!1):a("#proListSelect").dropdown("select",b.profileSettings.activeProfile),a("#proListSelect").dropdown("change"),a(".dialUpContent").show()},validateForm:function(){a("#proListSelect").dropdown(),a(".pdpTypeSelect").dropdown(),a(".authTypeSelect").dropdown(),a("#proListSelect").dropdown({onChanged:function(){var b=a("#proListSelect").val();a("#pdpTypeSelect").dropdown("select",f.proList.list[b].pdpType),f.proList.list[b].pdpType===Number(f.pdpType.ipv4)||f.proList.list[b].pdpType===Number(f.pdpType.ipv4_ipv6)?(a("#apnTypeSelect").dropdown("select",f.proList.list[b].ipv4ApnType),a("#apnTypeSelect").val()===f.apnType.dynamic?a("#apnInput").parent().hide():(a("#apnInput").parent().show(),a("#apnInput").val(f.proList.list[b].ipv4Apn)),a("#userNameInput").val(f.proList.list[b].ipv4Username),a("#passwordInput").val(f.proList.list[b].ipv4Password),a("#authTypeSelect").dropdown("select",f.proList.list[b].ipv4AuthType)):f.proList.list[b].pdpType===Number(f.pdpType.ipv6)&&(a("#apnTypeSelect").dropdown("select",f.proList.list[b].ipv6ApnType),a("#apnTypeSelect").val()===f.apnType.dynamic?a("#apnInput").parent().hide():(a("#apnInput").parent().show(),a("#apnInput").val(f.proList.list[b].ipv6Apn)),a("#userNameInput").val(f.proList.list[b].ipv6Username),a("#passwordInput").val(f.proList.list[b].ipv6Password),a("#authTypeSelect").dropdown("select",f.proList.list[b].ipv6AuthType)),a("#proListSelect").dropdown("pos")>=f.proList.defaultProfile?(a("#pdpTypeSelect").dropdown("enable"),a("#apnTypeSelect").dropdown("enable"),a("#apnInput").attr("disabled",!1),a("#userNameInput").attr("disabled",!1),a("#passwordInput").attr("disabled",!1),a("#authTypeSelect").dropdown("enable")):(a("#pdpTypeSelect").dropdown("disable"),a("#apnTypeSelect").dropdown("disable"),a("#apnInput").attr("disabled",!0),a("#userNameInput").attr("disabled",!0),a("#passwordInput").attr("disabled",!0),a("#authTypeSelect").dropdown("disable")),a(".dialUpSection").validate("resetForm")}}),a("#apnTypeSelect").dropdown({onChanged:function(){a("#apnTypeSelect").val()===f.apnType.dynamic?a("#apnInput").parent().hide():a("#apnInput").parent().show(),a(".dialUpSection").validate("resetForm",null,!0)}}),a("#creApnTypeSelect").dropdown({onChanged:function(){a("#creApnTypeSelect").val()===f.apnType.dynamic?a("#creApnInput").parent().hide():(a("#creApnInput").parent().show(),a("#creApnInput").focus()),a(".createProfile").validate("resetForm",null,!0)}}),a("#errMessagePopup").popup({$closeButtons:a("#errOK")}),a.Validator.addRule("validCharInput",function(a){return isProfileInputCharValid(a)},a.i18n.prop("profileError")),a.Validator.addRule("validProfileName",function(a){return isProfileNameValid(a)},a.i18n.prop("profileEndErr")),a.Validator.addRule("sameProfileName",function(b){var c,d=0;for(c=0;c<f.proList.list.length;c++)c!==a("#proListSelect").dropdown("pos")&&b===f.proList.list[c].profileName&&d++;return d>0?!1:!0},a.i18n.prop("profileSameErr")),a.Validator.addRule("createSameProfileName",function(a){var b,c=0;for(b=0;b<f.proList.list.length;b++)a===f.proList.list[b].profileName&&c++;return c>0?!1:!0},a.i18n.prop("profileSameErr")),a(".dialUpSection").validate({rules:{proNameInput:{required:!0,validCharInput:!0,validProfileName:!0,sameProfileName:!0},apnInput:{required:!0,validCharInput:!0},userNameInput:{validCharInput:!0},passwordInput:{validCharInput:!0}}}),a(".createProfile").validate({rules:{creProNameInput:{required:!0,validCharInput:!0,validProfileName:!0,createSameProfileName:!0},creApnInput:{required:!0,validCharInput:!0},creUserNameInput:{required:!1,validCharInput:!0},crePasswordInput:{required:!1,validCharInput:!0}}})},clearCreatePage:function(){a("#creProNameInput").val(""),a("#crePdpTypeSelect").dropdown("select",0),a("#creApnTypeSelect").dropdown("select",0),a("#creApnInput").val(""),a("#creUserNameInput").val(""),a("#crePasswordInput").val(""),a("#creAuthTypeSelect").dropdown("select",2)},handleSubmitdata:function(b){var c={},d={};return d.profileID=a("#proListSelect").dropdown("pos"),d.profileName=a("#proListSelect").dropdown("text"),d.pdpType=a("#pdpTypeSelect").dropdown("pos"),a("#pdpTypeSelect").val()===f.pdpType.ipv4||a("#pdpTypeSelect").val()===f.pdpType.ipv4_ipv6?(d.ipv4Apn=a("#apnInput").val(),d.ipv4ApnType=a("#apnTypeSelect").dropdown("pos"),d.ipv4Username=a("#userNameInput").val(),d.ipv4Password=a("#passwordInput").val(),d.ipv4AuthType=a("#authTypeSelect").dropdown("pos"),d.ipv6Apn=f.proList.list[a("#proListSelect").dropdown("pos")].ipv6Apn,d.ipv6ApnType=f.proList.list[a("#proListSelect").dropdown("pos")].ipv6ApnType,d.ipv6Username=f.proList.list[a("#proListSelect").dropdown("pos")].ipv6Username,d.ipv6Password=f.proList.list[a("#proListSelect").dropdown("pos")].ipv6Password,d.ipv6AuthType=f.proList.list[a("#proListSelect").dropdown("pos")].ipv6AuthType):a("#pdpTypeSelect").val()===f.pdpType.ipv6&&(d.ipv4Apn=f.proList.list[a("#proListSelect").dropdown("pos")].ipv4Apn,d.ipv4ApnType=f.proList.list[a("#proListSelect").dropdown("pos")].ipv4ApnType,d.ipv4Username=f.proList.list[a("#proListSelect").dropdown("pos")].ipv4Username,d.ipv4Password=f.proList.list[a("#proListSelect").dropdown("pos")].ipv4Password,d.ipv4AuthType=f.proList.list[a("#proListSelect").dropdown("pos")].ipv4AuthType,d.ipv6Apn=a("#apnInput").val(),d.ipv6ApnType=a("#apnTypeSelect").dropdown("pos"),d.ipv6Username=a("#userNameInput").val(),d.ipv6Password=a("#passwordInput").val(),d.ipv6AuthType=a("#authTypeSelect").dropdown("pos")),isEqual(d,f.proList.list[f.proList.activeProfile])||(c.list=[],c.list[0]=d,c.activeProfile=d.profileID,c.defaultProfile=f.proList.defaultProfile,b.profileSettings=c),!0},submit:function(){var b={};a("#proListSelect").dropdown("pos")>=f.proList.defaultProfile&&!a(".dialUpSection").valid()||(this.handleSubmitdata(b),callJSON(f.moduleName,f.action.set_Config,b,function(b){0===b.result?g.changed?(g.percentage=0,a("#rebootProgressPopup").popup("show"),g.doProgress(),g.submit()):a("#tabStatus").click():1===b.result&&Settings.showToast("icon-save-failed",a.i18n.prop("failedText"))}))},bindHandler:function(){a("#createProBtn").click(function(){return a("#proListSelect").find("option").length-f.proList.defaultProfile===8?(a("#errMessage").text(a.i18n.prop("fullProfileErr")),a("#errMessagePopup").popup("show"),void 0):(a(".dialUpSection").hide(),f.clearCreatePage(),a(".createProfile").show(),a("#profileNameHelp").show(),a("#profileListHelp").hide(),a("#creProNameInput").focus(),void 0)}),a("#createCancelBtn").click(function(){a(".createProfile").hide(),a(".createProfile").validate("resetForm"),a(".dialUpSection").show(),a("#profileNameHelp").hide(),a("#profileListHelp").show()}),a("#createSaveBtn").click(function(){var b,c={},d={};return a(".createProfile").valid()?(a("#crePdpTypeSelect").val()===f.pdpType.ipv4||a("#crePdpTypeSelect").val()===f.pdpType.ipv4_ipv6?b={profileID:f.proList.list.length,profileName:a("#creProNameInput").val(),pdpType:a("#crePdpTypeSelect").dropdown("pos"),ipv4Apn:a("#creApnInput").val(),ipv4ApnType:a("#creApnTypeSelect").dropdown("pos"),ipv4Username:a("#creUserNameInput").val(),ipv4Password:a("#crePasswordInput").val(),ipv4AuthType:a("#creAuthTypeSelect").dropdown("pos"),ipv6Apn:"",ipv6ApnType:0,ipv6Username:"",ipv6Password:"",ipv6AuthType:2}:a("#crePdpTypeSelect").val()===f.pdpType.ipv6&&(b={profileID:f.proList.list.length,profileName:a("#creProNameInput").val(),pdpType:a("#crePdpTypeSelect").dropdown("pos"),ipv4Apn:"",ipv4ApnType:0,ipv4Username:"",ipv4Password:"",ipv4AuthType:2,ipv6Apn:a("#creApnInput").val(),ipv6ApnType:a("#creApnTypeSelect").dropdown("pos"),ipv6Username:a("#creUserNameInput").val(),ipv6Password:a("#crePasswordInput").val(),ipv6AuthType:a("#creAuthTypeSelect").dropdown("pos")}),d.list=[],d.list[0]=b,d.activeProfile=b.profileID,c.profileSettings=d,c.profileSettings.defaultProfile=f.proList.defaultProfile,callJSON(f.moduleName,f.action.wzd_Add_Profile,c,function(b){0===b.result?(f.creSaveFlag=!0,a(".createProfile").hide(),f.setContent(),a(".dialUpSection").show(),a("#profileNameHelp").hide(),a("#profileListHelp").show()):1===b.result&&Settings.showToast("icon-save-failed",a.i18n.prop("failedText"))}),void 0):!1})}},g={moduleName:"wlan",percentage:0,progressTimer:0,changed:!1,noRegion:!1,serverData:{},securityMode:{noSecurity:0,wpaMixedSecurity:1},encryptMode:{TKIP:0,Auto:1,AES:2},band:{shortBand:"0",longBand:"1"},validateForm:function(){a.Validator.addRule("validSSIDInput",function(a){return checkSsidSanity(a)},a.i18n.prop("invalidSSIDErr")),a.Validator.addRule("validKeyInput",function(a){return checkWlanKeySanity(a)},a.i18n.prop("invalidKeyErr")),a.Validator.addRule("validLengthKey",function(){return a("#keyInput").val().length<8?!1:!0},a.i18n.prop("shortKeyErr")),a.Validator.addRule("validHexKeyInput",function(){if(64===a("#keyInput").val().length)for(var b,c="0123456789ABCDEFabcdef",d=0;64>d;d++)if(b=a("#keyInput").val().charAt(d),-1===c.indexOf(b))return!1;return!0},a.i18n.prop("hexadecimalErr")),a(".wirelessContent").validate({rules:{ssidInput:{required:!0,validSSIDInput:!0},keyInput:{required:!0,validKeyInput:!0,validLengthKey:!0,validHexKeyInput:!0}}})},setContent:function(){getConfigJSON(g.moduleName,g.loadData),getConfigJSON("status",function(b){"UN"===b.deviceInfo.productRegion&&(a("#regionForWizard").show(),a("#region").parent().show(),a("#regionHelpInfo").show())})},loadData:function(b){g.serverData=b,a("#ssidInput").val(b.ssid),a("#keyInput").val(b.mixed.key),a("#wirelessBandSelect").dropdown(),a("#wirelessBandSelect").dropdown("select",b.bandType),a("#regionSelect").dropdown({onChanged:function(){0===region[a("#regionSelect").val()].longBand.length?(a("#wirelessBandSelect").dropdown("select",g.band.shortBand),a("#wirelessBandSelect").dropdown("disable")):a("#wirelessBandSelect").dropdown("enable"),a("#regionSelect").parent().removeClass("open")}}),"NONE"===b.region?(g.noRegion=!0,b.expectRegion?(a("#regionSelect").dropdown("select",b.expectRegion),b.region=b.expectRegion,a("#regionSelect").parent().addClass("open")):(a("#regionSelect").dropdown("select","US"),b.region="US",a("#regionSelect + .dropdown-toggle").text(a.i18n.prop("selectRegion")))):a("#regionSelect").dropdown("select",b.region),0===region[b.region].longBand.length&&a("#wirelessBandSelect").dropdown("disable"),a("#rebootProgressPopup").popup({noXButton:!0})},submit:function(){var b={};b.action=1,a(".wirelessContent").valid()&&(b.ssid=a("#ssidInput").val(),b.region=g.noRegion&&g.serverData.expectRegion&&a("#regionSelect + .dropdown-toggle").text()===region[g.serverData.expectRegion].country?g.serverData.expectRegion:a("#regionSelect").val(),b.securityMode=g.securityMode.wpaMixedSecurity,b.mixed={},b.mixed.mode=g.encryptMode.Auto,b.mixed.key=a("#keyInput").val(),b.bandType=a("#wirelessBandSelect").dropdown("pos"),callJSON(g.moduleName,b.action,b,function(b){1===b.result&&(g.percentage=0,a("#rebootProgressPopup").popup("hide"),window.clearTimeout(g.progressTimer),Settings.showToast("icon-save-failed",a.i18n.prop("failedText")))}))},setProgress:function(){g.percentage&&(a("#progressBar").css("width",String(g.percentage/10)+"%"),a("#progressBar").text(parseInt(g.percentage/10)+"%"))},doProgress:function(){return g.percentage>1e3?(window.location.reload(),void 0):(g.percentage<=1e3&&(g.progressTimer=window.setTimeout(g.doProgress,10),g.setProgress(),g.percentage++),void 0)}},h={setContent:function(){a("#proName").text(a("#proListSelect").dropdown("text")),a("#pdpType").text(a("#pdpTypeSelect").dropdown("text")),a("#apnType").text(a("#apnTypeSelect").dropdown("text")),a("#apnTypeSelect").val()===f.apnType.dynamic?a("#apn").parent().hide():(a("#apn").text(a("#apnInput").val()),a("#apn").parent().show()),a("#userName").text(a("#userNameInput").val()),a("#password").text(a("#passwordInput").val()),a("#authType").text(a("#authTypeSelect").dropdown("text")),a("#region").text(a("#regionSelect").dropdown("text")),a("#wirelessBand").text(a("#wirelessBandSelect").dropdown("text")),a("#ssid").text(a("#ssidInput").val()),a("#wzdwirelessKey").text(a("#keyInput").val()),g.changed=a("#ssidInput").val()!=g.serverData.ssid||a("#regionSelect").val()!=g.serverData.region||g.noRegion||a("#keyInput").val()!=g.serverData.mixed.key||a("#wirelessBandSelect").dropdown("pos")!=g.serverData.bandType?!0:!1},bindHandler:function(){a("#wzdFinishBtn").click(function(){f.submit()})}},i={validateForm:function(){return a("#setPsw").popup(),a("#sameIndex").hide(),Settings.showSetPsw!==!0?(a("#setPsw").popup("hide"),void 0):(Settings.showSetPsw=!1,a("#setPsw").popup("show"),a("#newUsernameInput").focus(),callJSON("webServer",3),a.Validator.addRule("validUsername",function(a){return isValidUsername(a)},a.i18n.prop("invalidUsernameErr")),a.Validator.addRule("validPassword",function(a){return isValidPassword(a)},a.i18n.prop("invalidPasswordErr")),a.Validator.setErrorMessage("equalTo",a.i18n.prop("differentErr")),a("#setPsw").validate({rules:{newUsernameInput:{required:!0,validUsername:!0},newPasswordInput:{required:!0,validPassword:!0},newPswConfirmInput:{required:!0,equalTo:"newPasswordInput"}},password:["newPasswordInput","newPswConfirmInput"]}),a("#newPasswordInput").keyup(function(){var b=checkPassword(a("#newPasswordInput").val()),c=isValidPassword(a("#newPasswordInput").val());c===!1?(a("#lowIndex").attr("class","icon-low-gray"),a("#middleIndex").attr("class","icon-middle-gray"),a("#highIndex").attr("class","icon-high-gray")):b>=70?(a("#lowIndex").attr("class","icon-low-gray"),a("#middleIndex").attr("class","icon-middle-gray"),a("#highIndex").attr("class","icon-high-green")):b>=50?(a("#lowIndex").attr("class","icon-low-gray"),a("#middleIndex").attr("class","icon-middle-orange"),a("#highIndex").attr("class","icon-high-gray")):b>0?(a("#lowIndex").attr("class","icon-low-red"),a("#middleIndex").attr("class","icon-middle-gray"),a("#highIndex").attr("class","icon-high-gray")):(a("#lowIndex").attr("class","icon-low-gray"),a("#middleIndex").attr("class","icon-middle-gray"),a("#highIndex").attr("class","icon-high-gray")),a("#newPswConfirmInput").val()===a("#newPasswordInput").val()?""===a("#newPasswordInput").val()?a("#sameIndex").hide():a("#sameIndex").show():""!==a("#newPswConfirmInput").val()&&a("#sameIndex").hide()}),a("#newPasswordInput").blur(function(){a("#newPasswordInput").keyup()}),a("#newPswConfirmInput").keyup(function(){a("#newPswConfirmInput").val()===a("#newPasswordInput").val()?""===a("#newPasswordInput").val()?a("#sameIndex").hide():a("#sameIndex").show():a("#sameIndex").hide()}),a("#newPswConfirmInput").blur(function(){a("#newPswConfirmInput").keyup()}),a("#wzdPswConfirm").click(function(){var b="authenticator",c={},d=4;a("#setPsw").valid()&&(a("#sameIndex").hide(),c.username="admin",c.password="admin",c.newUsername=a("#newUsernameInput").val(),c.newPassword=a("#newPasswordInput").val(),callJSON(b,d,c,function(b){0===b.result?a("#setPsw").popup("hide"):a("#auth_err_message").text(a.i18n.prop("setFailErr"))}))}),a("#setPsw").bind("keyup",function(){var b=window.event||arguments[0];b.returnValue=!1;var c=b.keyCode||b.which;13===c&&a("#wzdPswConfirm").click()}),void 0)}};a.wizard={onLoad:function(){b(),i.validateForm(),f.validateForm(),f.setContent(),f.bindHandler(),g.validateForm(),g.setContent(),dualIPVersionSupport&&(a("#pdpTypeSelect").dropdown("addItem",a.i18n.prop("ipv4Andipv6PdpOpt"),"2",2),a("#crePdpTypeSelect").dropdown("addItem",a.i18n.prop("ipv4Andipv6PdpOpt"),"2",2)),a("#wzdDialUpNextBtn").click(function(){a("#proListSelect").dropdown("pos")>=f.proList.defaultProfile&&!a(".dialUpSection").valid()||(a("#wzdDialUpTitle").removeClass("active").addClass("inactive"),a("#wzdWirelessTitle").removeClass("inactive").addClass("active"),a("#icon-progress").removeClass("icon-progress-1").addClass("icon-progress-2"),a(".dialUpContent").hide(),a(".wirelessContent").show(),d())}),a("#wzdWirelessNextBtn").click(function(){if(a(".wirelessContent").valid()){if(a("#regionSelect").dropdown("text")===a.i18n.prop("selectRegion"))return a("#regionSelect").parent().addClass("open"),a("#errMessage").text(a.i18n.prop("regionErr")),a("#errMessagePopup").popup("show"),void 0;h.setContent(),h.bindHandler(),a("#wzdWirelessTitle").removeClass("active").addClass("inactive"),a("#wzdFinishTitle").removeClass("inactive").addClass("active"),a("#icon-progress").removeClass("icon-progress-2").addClass("icon-progress-3"),a(".wirelessContent").hide(),a(".finishContent").show(),e()}}),a("#wzdWirelessBackBtn").click(function(){a("#wzdWirelessTitle").removeClass("active").addClass("inactive"),a("#wzdDialUpTitle").removeClass("inactive").addClass("active"),a("#icon-progress").removeClass("icon-progress-2").addClass("icon-progress-1"),a(".wirelessContent").hide(),a(".dialUpContent").show(),c()}),a("#wzdFinishBackBtn").click(function(){a("#wzdFinishTitle").removeClass("active").addClass("inactive"),a("#wzdWirelessTitle").removeClass("inactive").addClass("active"),a("#icon-progress").removeClass("icon-progress-3").addClass("icon-progress-2"),a(".finishContent").hide(),a(".wirelessContent").show(),d()}),a(".wzdCancel").click(function(){a("#tabStatus").click()})}}}(jQuery),function(a){function b(){a.i18n.elementLocalization("#adv_panel-wrapper",["label","span","button"]),a.i18n.switchFont()}function c(){a("#wpsEnableSwitch").switchButton({onChanged:function(b){j?b?(a("#wpsSaveBtn").slideUp("fast"),a(".wpsConfig").slideDown("fast")):(a(".wpsConfig").slideUp("fast"),a("#wpsSaveBtn").slideDown("fast")):a(".wpsConfig").hide()}}),a(".radio").radio(!0,".radio"),a("#pinRadio").radio("callback",function(){a("#wps_pinInput").val().length>0&&!a(".wpsSection").valid()}),a("#pbcRadio").radio("callback",function(){a(".wpsSection").validate("resetForm",wps_pinInput,!1)}),a("#pbcRadio").data("radio").setChecked(!0),a("#rebootProgressPopup").popup({noXButton:!0}),a.Validator.addRule("validPINInput",function(b){for(var c,d="0123456789",e=0;e<a("#wps_pinInput").val().length;e++)if(c=b.charAt(e),-1===d.indexOf(c))return!1;return 8!==b.length?!1:!0},a.i18n.prop("invalidPinErr")),a(".wpsSection").validate({rules:{wps_pinInput:{required:!0,validPINInput:!0}}})}function d(){getConfigJSON(k,function(b){j=b.enable,a("#wpsEnableSwitch").switchButton("changeState",j,!0),a("#wpsOperateBtn").text(a.i18n.prop("wpsStartBtn")),a("#connectingImg").hide(),b.status===o.connecting?(a("#currentStatus").text(""),a("#connectingImg").show(),a("#wpsOperateBtn").text(a.i18n.prop("wpsCancelBtn")),l=window.setTimeout(f,3e3)):a("#currentStatus").text(a.i18n.prop("wpsIdle")),b.type===p.pin?(a("#pinRadio").data("radio").setChecked(!0),a("#wps_pinInput").val(b.pin)):b.type===p.pbc&&(a("#pbcRadio").data("radio").setChecked(!0),a("#wps_pinInput").text("")),b.enable&&a(".wpsConfig").slideDown("fast"),a(".wpsSection").show()})}function e(b){switch(b.status){case o.succeeded:a("#currentStatus").text(a.i18n.prop("wpsSucceed")),a("#wpsOperateBtn").text(a.i18n.prop("wpsStartBtn"));break;case o.failed:a("#currentStatus").text(a.i18n.prop("wpsFailed")),a("#wpsOperateBtn").text(a.i18n.prop("wpsStartBtn"));break;case o.connecting:a("#currentStatus").text(""),a("#connectingImg").show(),a("#wpsOperateBtn").text(a.i18n.prop("wpsCancelBtn")),l=window.setTimeout(f,3e3);break;case o.timeout:a("#currentStatus").text(a.i18n.prop("wpsTimeout")),a("#wpsOperateBtn").text(a.i18n.prop("wpsStartBtn"));break;case o.canceled:a("#currentStatus").text(a.i18n.prop("wpsCancel")),a("#wpsOperateBtn").text(a.i18n.prop("wpsStartBtn"));break;default:a("#currentStatus").text(a.i18n.prop("wpsIdle"))}b.status!==o.connecting&&a("#connectingImg").hide()}function f(){getConfigJSON(k,e)}function g(){m&&(a("#progressBar").css("width",String(m/10)+"%"),a("#progressBar").text(parseInt(m/10)+"%"))}function h(){return m>1e3?(window.location.reload(),void 0):(1e3>=m&&(n=window.setTimeout(h,10),g(),m++),void 0)}function i(){a("#wpsOperateBtn").click(function(){if(a("#wpsOperateBtn").text()===a.i18n.prop("wpsStartBtn")){var b={};if(b.action=2,b.enable=!0,a("#pinRadio").data("radio").getChecked()){if(b.type=0,!a(".wpsSection").valid())return;b.pin=a("#wps_pinInput").val()}else a("#pbcRadio").data("radio").getChecked()&&(b.type=1,b.pin="00000000");a("#wps_err_message").text(""),a("#wpsOperateBtn").text(a.i18n.prop("wpsCancelBtn")),a("#currentStatus").text(""),a("#connectingImg").show(),callJSON(k,b.action,b,function(a){0===a.result&&(l=window.setTimeout(f,3e3))})}else{var c={};c.action=3,c.enable=!0,a("#wps_err_message").text(""),a("#wpsOperateBtn").text(a.i18n.prop("wpsStartBtn")),a("#connectingImg").hide(),a("#currentStatus").text(a.i18n.prop("wpsCancel")),window.clearTimeout(l),callJSON(k,c.action,c,function(){})}}),a("#wifiRebootPopup").popup({$closeButtons:a("#wifiRebootCancel")}),a("#wpsSaveBtn").click(function(){isEqual(j,a("#wpsEnableSwitch").switchButton("checked"))?Settings.showToast("icon-save-failed",a.i18n.prop("noChangeText")):a("#wifiRebootPopup").popup("show")}),a("#wifiRebootOK").click(function(){var b={};b.action=1,b.enable=a("#wpsEnableSwitch").switchButton("checked"),a("#wifiRebootPopup").popup("hide"),a("#wps_err_message").text(""),callJSON(k,b.action,b,function(b){0===b.result?(m=0,a("#rebootProgressPopup").popup("show"),h()):1===b.result&&(window.clearTimeout(n),a("#rebootProgressPopup").popup("hide"),Settings.showToast("icon-save-failed",a.i18n.prop("failedText")))})})}var j,k="wps",l=0,m=0,n=0,o={idle:0,succeeded:1,failed:2,connecting:3,timeout:4,canceled:5},p={pin:0,pbc:1};a.wpsConfig={onLoad:function(){b(),c(),d(),i()},onLeave:function(){l&&window.clearTimeout(l)}}}(jQuery);