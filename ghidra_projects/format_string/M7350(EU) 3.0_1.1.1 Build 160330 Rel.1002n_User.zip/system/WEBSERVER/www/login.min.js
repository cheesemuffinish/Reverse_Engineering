/* =============================================================
 * Copyright (c) 2014 TP-LINK Technologies Co., Ltd.
 *
 * @version: 0.0.1
 * @author: TP-Mobile Web Team
 * =============================================================*/

function langSwitch(){callJSON(WEB_MODULE,ACTION.SET_LANGUAGE,{language:$("#langSel").val()},function(a){0===a.result&&window.location.reload()})}function initLanguage(){callJSON(WEB_MODULE,ACTION.GET_LANGUAGE,null,function(a){$("#langSel").val(a.language),$.i18n.setLocale(a.language)},null,null,!1),$.i18n.elementLocalization("body",["label","span","button","option"]),$.i18n.switchFont()}function checkParams(){-1!==location.search.indexOf("timeout")?$("#noteDiv").text($.i18n.prop("sessionTimeout")).show():-1!==location.search.indexOf("kickedOut")&&$("#noteDiv").text($.i18n.prop("kickedOut")).show()}var WEB_MODULE="webServer",ACTION={GET_LANGUAGE:0,SET_LANGUAGE:1},firstLoad=!0,simpleStatus={moduleName:"status",connStatus:{disable:0,disconnected:1,connecting:2,disconnecting:3,connected:4},networkType:{noSevrice:0,gsm:1,wcdma:2,lte:3,tdscdma:4,cdma1x:5,cdmaevdo:6},simStatus:{invalid:0,noSim:1,error:2,ready:3,pinReq:4,pinVerified:5,pukReq:6,permanentLock:7},loadData:function(a){switch($("#deviceName").text(a.deviceInfo.model),a.wan.connectStatus){case simpleStatus.connStatus.connected:$("#connection").text($.i18n.prop("connectedStatus")).removeClass("warnLabel").addClass("okLabel"),$("#linkingImg").hide();break;case simpleStatus.connStatus.disconnected:$("#connection").text($.i18n.prop("disconnectedStatus")).addClass("warnLabel").removeClass("okLabel"),$("#linkingImg").hide();break;case simpleStatus.connStatus.connecting:$("#connection").text($.i18n.prop("connectingStatus")).removeClass("warnLabel okLabel"),$("#linkingImg").show();break;case simpleStatus.connStatus.disconnecting:$("#connection").text($.i18n.prop("disconnectingStatus")).removeClass("warnLabel okLabel"),$("#linkingImg").show();break;default:$("#connection").text($.i18n.prop("connectedStatus")).removeClass("warnLabel").addClass("okLabel"),$("#linkingImg").hide()}if(simpleStatus.connStatus.disconnected===a.wan.connectStatus||simpleStatus.connStatus.connecting===a.wan.connectStatus){switch(a.wan.simStatus){case simpleStatus.simStatus.invalid:$("#simStatus").text($.i18n.prop("simInvalid")).addClass("warnLabel");break;case simpleStatus.simStatus.noSim:$("#simStatus").text($.i18n.prop("noSim")).addClass("warnLabel");break;case simpleStatus.simStatus.error:$("#simStatus").text($.i18n.prop("simErr")).addClass("warnLabel");break;case simpleStatus.simStatus.ready:$("#simStatus").text($.i18n.prop("simReady")).removeClass("warnLabel");break;case simpleStatus.simStatus.pinReq:$("#simStatus").text($.i18n.prop("pinReq")).removeClass("warnLabel");break;case simpleStatus.simStatus.pinVerified:$("#simStatus").text($.i18n.prop("pinVerified")).removeClass("warnLabel");break;case simpleStatus.simStatus.pukReq:$("#simStatus").text($.i18n.prop("pukReq")).removeClass("warnLabel");break;case simpleStatus.simStatus.permanentLock:$("#simStatus").text($.i18n.prop("permanentLock")).addClass("warnLabel");break;default:$("#simStatus").text($.i18n.prop("simInvalid")).addClass("warnLabel")}$("#networkType").parent().hide(),$("#simStatus").parent().show()}else{switch(a.wan.networkType){case simpleStatus.networkType.noService:$("#networkType").text($.i18n.prop("noService"));break;case simpleStatus.networkType.lte:$("#networkType").text($.i18n.prop("lteType"));break;case simpleStatus.networkType.wcdma:$("#networkType").text($.i18n.prop("wcdmaType"));break;case simpleStatus.cdma1x:$("#networkType").text($.i18n.prop("cdma1xType"));break;case simpleStatus.cdmaevdo:$("#networkType").text($.i18n.prop("cdmaevdoType"));break;case simpleStatus.networkType.tdscdma:$("#networkType").text($.i18n.prop("tdscdmaType"));break;case simpleStatus.networkType.gsm:$("#networkType").text($.i18n.prop("gsmType"));break;default:$("#networkType").text($.i18n.prop("noService"))}$("#simStatus").parent().hide(),$("#networkType").parent().show()}a.wlan.bandType?$("#wirelessBand").text("5GHz"):$("#wirelessBand").text("2.4GHz"),$("#ssid").text(a.wlan.ssid),$("#curClients").text(""+a.connectedDevices.number),a.wan.enablePaymentDay&&$("#totalDataLbl").text($.i18n.prop("monthDataLbl"));var b=byteAdapt(a.wan.totalStatistics);$("#totalData").text(""+b[0]),$("#totalDataUnit").text(""+b[1]),firstLoad&&($("#loginPage").show(),$("#username").focus(),firstLoad=!1)},setContent:function(){getConfigJSON(simpleStatus.moduleName,simpleStatus.loadData)},main:function(){this.setContent(),setInterval(simpleStatus.setContent,1e4)}},login={moduleName:"authenticator",loadData:function(a){1===a.result&&"0.0.0.0"!==a.authedIP&&$("#noteDiv").text($.i18n.prop("onlyOne")).show(),checkParams(),$("#username").focus()},listener:function(a){a&&a()},setAdminContent:function(){getConfigJSON(this.moduleName,this.loadData),callJSON(login.moduleName,2,null,login.onCheckLocked)},loginCallback:function(a){switch(a){case AUTH_RES.success:window.location.href="settings.html";break;case AUTH_RES.pwdWrong:$("#noteDiv").text($.i18n.prop("pswWrong")).show(),callJSON(login.moduleName,2,null,login.onCheckLocked);break;default:$("#noteDiv").text($.i18n.prop("unknownResult")).show()}},onCheckLocked:function(a){0===a.result&&0===a.remainAttempts&&($("#username").prop("disabled",!0),$("#password").prop("disabled",!0),$("#noteDiv").text($.i18n.prop("loginLocked")).show())},doLogin:function(){var a=$("#username").val(),b=$("#password").val();return a&&b?($("#noteDiv").hide(),AuthModel.login(a,b,login.loginCallback),void 0):($("#noteDiv").text($.i18n.prop("emptyInputErr")).show(),void 0)},setupListeners:function(){$("#loginBtn").on("click",login.doLogin),$("#password").bind("keyup",function(){var a=window.event||arguments[0];a.returnValue=!1;var b=a.keyCode||a.which;13===b&&$("#loginBtn").click()})},main:function(){this.listener(login.setupListeners),this.setAdminContent()}};$(function(){initLanguage(),$("#langSel").dropdown({onChanged:langSwitch}).dropdown("refreshText"),$("#username").val(""),$("#username").prop("disabled",!1),$("#password").val(""),$("#password").prop("disabled",!1),simpleStatus.main(),setDocInfo(),login.main()});var g_curPageID=0;